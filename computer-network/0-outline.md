**计算机网络复习提纲**

**Chapter 1****：计算机网络和因特网**

**1.1****什么是因特网**

**1.1.1****具体构成描述（****bolts and nuts view****）**

²  主机或端系统

²  通信链路

²  路由器

²  协议

²  网络的网络

**1.1.2****服务描述**

²  因特网是一种基础设施，新应用程序在其上不断地被发明和设置；

²  因特网为应用程序提供多种服务。

**1.1.3****什么是协议**

²  网络协议：类似于人类协议，交换报文和采取动作的实体是某些设备的硬件或软件组件。

²  协议的定义：一个协议定义了两个或多个通信实体之间交换的报文格式和次序，以及在报文传输和/或接受其他时间方面所采取的动作。

 

**1.2****网络边缘**

²  端系统也称为主机，主机被划分为客户机和服务器。

²  客户机非正式的等同于桌面PC、移动PC和PDA，服务器非正式的等同于更为强大的机器，用于存储和发布web页面、流视频以及转发电子邮件等。

**1.2.1****客户机和服务器程序**

²  客户机程序是运行在一个端系统上的程序，它发出请求，并从运行在另一个端系统上的服务器程序接收服务。

**1.2.2****接入网**

²  边缘路由器：由端系统到任何其他远程端系统的路径上的第一台路由器。

²  接入网（access network）：将端系统连接到边缘路由器的物理链路。

²  接入网大致不严格的分为以下三种类型：

v  住宅接入（residential access networks）：

1)         拨号调制解调器

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image001.png)

家用调制解调器将PC输出的数字信号转换为模拟形式，在模拟电话线上传输，ISP的调制解调器接收到模拟信号转换成数字形式。

速率：最高至56kbps。（缓慢地令人难以接受）

2)         数字用户线（digital subscriber line， DSL）：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image002.png)

高速下行信道，位于50kHz到1MHz频段；

中速上行信道，位于4kHz到50kHz频段；

普通的双向电话信道，位于0到4kHz频段。

带宽专用。

3)         混合光纤同轴电缆（hybrid fiber-coaxial cable， HFC）：

共享广播媒体。

带宽共享。

4)         卫星链路：速率超过1Mbps。

v  公司接入（company access networks）：以太网技术（Ethernet）

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)

v  无线接入（wireless access networks）：

1)         无线局域网：无线用户与位于几十米半径内的基站（无线接入点）之间传输/接收分组。

2)         广域无线接入网（wide-area wireless access network）：分组经用于蜂窝电话的想听无线基础设施发送，基站由电信提供商管理，为数万米半径内用户提供无线接入服务。

**1.2.3****物理媒体**

²  导引型媒体：电波沿着固体媒体被导引。

²  非导引型媒体：电波在空气或外层空间（如无线局域网或数字卫星频道）中传播。

**1.3****网络核心**

²  网络核心：互联因特网端系统的分组交换机和链路的网状网络。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

**1.3.1****电路交换和分组交换**

²  电路交换：两台主机要通信时，网络在两台主机之间创建一条专用的端到端连接（预留一条电路）。

1)         每条链路具有n条电路，每条链路由端到端连接使用，该连接在连接期间获得该链路带宽的1/n。

2)         电路交换网络中的多路复用：

a.          频分多路复用（FDM）：链路的频谱由跨越链路创建的所有链路共享，每条连接专用一个频段。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg)

b.          时分多路复用（TDM）：时间被划分为固定区间的帧，并且每帧被划分为固定数量的时隙，创建连接时，网络在每帧中为该连接指定一个时隙，这些时隙专门为该连接单独使用。

​    ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)

3)         电路交换的问题：静默期专用电路空闲——效率低。

²  分组交换：源主机将分组划分成为较小的数据块，并称之为分组。在源和目的地之间，分组以链路的最大传输速率在通信链路上传输。

1)         存储转发机制：交换机能够开始向输出链路传输该分组的第一个比特之前，必须接收到整个分组。（引入存储转发时延）

2)         排队时延：分组在输出缓存中等待。

3)         分组丢失（丢包）：分组到达时输出缓存被充满。

²  电路交换与分组交换的对比：

1)         分组交换的端到端时延是变动和不可预测的，故不适合实时服务；

2)         分组交换提供了比电路交换更好的带宽共享；

3)         分组交换比电路交换更简单、有效，实现成本更低；

4)         总的来说，分组交换的性能能够优于电路交换。

²  统计多路复用（statistical multiplexing）：按需（而不是预分配）共享资源被称为资源的统计多路复用。

**1.3.2****分组是怎样通过分组交换网形成其通路的**

每个通过网络传输的分组在它的首部包含了其目的地址，当分组到达一台路由器时，该路由器检查分组目的地址的一部分，并向相邻路由器转发该分组。每个路由器具有一个转发表用于将目的地址（或目的地址的一部分）映射到输出链路。

**1.3.3 ISP****和因特网主干**

²  因特网是网络的网络。

²  因特网边缘的接入网络通过分层的ISP层次结构与因特网的其他部分相连：第一层ISP、第二层ISP、接入ISP。 

²  第一层ISP：也被称为因特网主干（Internet backbone）网络。

1)         直接与其他**每一个**第一层ISP相连；

2)         与大量的第二层和其他客户网络相连；

3)         覆盖国际区域。

²  当两个ISP直接相连时，它们被称为彼此时对等的。

²  汇集点（Point of Presence， POP）：在一个ISP中，某ISP和其他ISP的连接点被称为汇集点。

 

**1.4****分组交换网中的时延、丢包和吞吐量**

**1.4.1****分组交换网中的时延概述**

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image011.png)

²  处理时延（nodal processing）：检查分组首部和决定该分组导向何处，检查比特差错所需的时间。

²  排队时延（queuing）：分组在链路上等待传输的时延，取决于先期到达的、正在排队等待向链路传输的分组的数量。

²  传输时延（transmission）：将所有分组的比特推（传输）向链路所需要的时间。

²  传播时延（propagation）：从链路的起点到下一个路由器传播所需要的时间。

**1.4.2****排队时延和丢包**

²  排队时延对不同的分组不同的，取决于流量到达该队列的速率、链路的传输速率和到达流量的性质（周期性到达或突发形式到达）。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image013.jpg)

²  流量强度（traffic intensity）：La/R

La/R→0：几乎没有分组到达，并且到达间隔很大，平均排队时延接近于0。

La/R→1：可能有很大的平均排队时延。

La/R > 1：比特到达队列的平均速率超过从该队列传输出去的速率，队列的增加趋于**无界。**

²  丢包：到达分组发现满队列时将被丢弃。（丢失分组的数量随着流量强度的增加而增加）

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image014.png)

**1.4.3****端到端时延**

²  Traceroute：

假设源和目的地之间有N-1台路由器，则源向网络发送N个特殊的分组，其中每个分组地址指向最终目的地。这N个特殊分组标识为1到N。当第n台路由器接受到第n个标识为n的分组时，该路由器不是向它的目的地转发该分组，而是向源回送一个报文。该源记录从它发送一个分组到它接收到对应返回报文所经受的时间以及返回该报文的路由器（或目的主机）的名字和地址

**源能够重建从源到目的地所采用的路由，并且该源决定到所有中间路由器的往返时延。**

**Traceroute****在上述描述的实验重复了****3****次。（向目的地发送****3\*N****个分组）**

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image016.jpg)

**1.4.4****计算机网络的吞吐量**

²  瞬时吞吐量：任何瞬间主机B接收文件的速率。

²  平均吞吐量：在一段时间内接收文件的平均速率。

²  服务器到客户机传输文件的吞吐量是沿着它们之间路径的瓶颈链路的速率。

²  因特网中对吞吐量的限制因素通常是接入网。

 

**1.5****协议层次和它们的服务模型**

**1.5.1****分层的体系结构**

²  分层的原因：

1)         可以讨论一个定义良好且大而复杂的系统的特定部分；

2)         模块化使得维护和提升更加容易。

²  分层的潜在缺点：

1)         某层可能重复较低层的功能；

2)         某层的功能可能需要仅在其他某层才出现的信息。

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image018.jpg)各层的所有协议称为协议栈。

²  因特网的协议栈组成（自顶向下方法）：

1)         应用层；

2)         运输层：提供在应用程序端点之间传送应用层报文的服务；

3)         网络层：将网络层分组从一台主机移动到另一台主机；

4)         链路层：为了将分组从一个节点（主机或路由器）移动到路径上的下一个节点，网络层必须依靠链路层的服务；

5)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image020.jpg)物理层：将帧中的每个比特从一个节点移动到下一个节点。

²  ISO模型：国际标准化组织（ISO）提出开放系统互联模型（OSI），将计算机网络组织分为7层。

1)         表示层（presentation）：使通信的应用程序能够解释交换数据的含义，提供的服务包括数据压缩、数据解密、数据描述；

2)         会话层（session）：提供数据交换的定界和同步功能，包括建立检查点和恢复方案的方法。

**1.5.2****报文、报文段、数据报和帧**

²  封装（encapsulation）

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image022.jpg)

²  报文：应用层信息分组。

²  报文段：运输层分组。

²  数据报：网络层分组。

²  帧：链路层分组。

²  物理层传输比特。

 

**1.6****攻击威胁下的网络**

²  病毒（virus）：需要某种形式的用户交互来感染用户设备的恶意软件。

²  蠕虫（worm）：无需任何明显用户交互就能进入用户设备的恶意软件。

²  特洛伊木马（Trojan horse）：隐藏在有用软件中的恶意软件。

²  坏家伙如何攻击计算机网络：

1)         经因特网将恶意软件放入你的计算机；

u  病毒（virus）：需要某种形式的用户交互来感染用户设备的恶意软件。

u  蠕虫（worm）：无需任何明显用户交互就能进入用户设备的恶意软件。

u  特洛伊木马（Trojan horse）：隐藏在有用软件中的恶意软件。

2)         攻击服务器和网络基础设施；

u  弱点攻击：向目标主机易受攻击的应用程序或操作系统发送制作精细的报文；

u  带宽洪泛：向目的主机发送大量的分组，导致目标的接入链路变得拥塞，使合法分组无法到达服务器；

u  连接洪泛：在目标主机中创建大量的半开或全开TCP连接，目标主机因伪造的连接而陷入困境，停止合法的连接。

3)         嗅探分组；

u  记录每个流经的分组拷贝的被动接收机：分组嗅探器。

u  分组嗅探器是被动的，不向信道中注入分组，从而哪一检测他们的存在

4)         伪装成你信任的人；

u  IP哄骗（IP spoofing）：将具有虚假原地址的分组诸如因特网的能力。

u  采用端点鉴别机制，确保报文源自正确的地方。

5)         修改或删除报文。

u  中间人攻击：坏家伙插入到两个通信实体之间的通信路径中，可以嗅探到主机之间传递的分组，甚而危及到发送数据的完整性。

 

**1.7****计算机网络和因特网的历史**

 

**Chapter 2****：应用层**

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image024.jpg)**2.1****应用层协议原理**

**2.1.1****网络应用程序体系结构**

²  客户机/服务器体系结构：

1)         服务器：

u  总是打开；

u  固定、周知的IP地址；

u  主机群集（服务器场，server farm）：创建强大的虚拟服务器，避免一台服务器处理所有请求不堪重负。

2)         客户机：

u  不总是打开；

u  向服务器发出请求；

u  IP地址不固定；

u  客户机与客户机之间不直接联系。

²  P2P体系结构：对总是打开的基础设施服务器有最小的（或没有）依赖，任意间断连接的主机对（对等方）直接相互通信。

u  最突出特性：自扩展性（self-scalability）——尽管每个对等方请求文件产生负载，但每个对等方向其他对等方分发文件也为系统增加了服务能力。

u  不需要庞大的服务器基础设施和服务器带宽。

²  CS和P2P混合体系结构。

**2.1.2****进程通信**

²  进程运行在同一端系统：进程间通信机制。

²  进程运行在不同端系统：交换报文。

²  客户机和服务器进程：在给定的一对进程之间的通信会话中，发起通信（即在会话开始时与其他进程联系）的进程被标识为客户机，在会话开始时等待联系的进程是服务器。

²  对于P2P文件共享，下载文件的对等方被标识为客户机，上载文件的对等方被标识为服务器。

²  套接字（sockets）：同一台主机内应用层与运输层之间的接口，是在网络上建立网络应用程序的可编程接口（因此套接字也成为应用程序和网络之间的应用程序编程接口）。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image026.jpg)

**2.1.3****可供应用程序使用的运输服务**

²  可靠数据传输

²  吞吐量：运输层协议能够以某种特定的速率提供确保的可用吞吐量。

1)         带宽敏感的应用：具有吞吐量要求；

2)         弹性应用：根据需要充分利用可够使用的吞吐量。

²  定时：在实时应用中，为了有效性而对数据交付有严格的时间限制。

²  安全性：对发送进程和接收进程保密，以防发送进程和接收进程以某种方式观察导数据。

**2.1.4****因特网提供的运输服务**

²  TCP：

1)         面向连接服务：连接是全双工的——连接双方的进程可以在此连接上同时进行报文收发。

2)         可靠数据传输服务：无差错、按适当顺序交付发送的数据。

3)         拥塞控制机制：发送方与接收方之间的网络出现拥塞时，TCP协议抑制发送进程。TCP协议试图限制每个TCP连接，以达到公平共享带宽的目的。

²  UDP：不提供不必要服务的轻量级运输层协议，仅提供最小服务。

²  因特网运输层协议：不提供吞吐量和定时服务。

²  进程寻址：

1)         主机的名称或地址——IP地址；

2)         指定目的主机上接收进程的标识——目的地端口号。

**2.1.5****应用层协议**

²  应用层协议定义：

1)         交换报文的类型：请求报文、响应报文；

2)         各种报文类型的语法；

3)         字段的语义；

4)         进程何时、如何发送报文及对报文进行响应的规则。

**2.1.6****本书涉及的网络应用**

 

**2.2 Web****应用和****HTTP****协议**

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image028.jpg)**2.2.1 HTTP****概况**

²  Web页面由对象组成。

²  对象：文件，例如HTML文件、JPEG图形文件、Java小程序或视频片段文件，可通过URL地址寻址。

²  URL地址：由存放对象的服务器主机名和对象的路径名共同组成。

²  HTTP（超文本传输协议）：

1)         由一个客户机程序和一个服务器程序组成，通过交换报文进行会话；

2)         HTTP协议定义报文的格式以及交换报文的方式；

3)         使用TCP作为运输层协议；

4)         无状态协议：HTTP协议不保存客户机的任何信息。

**2.2.2****非持久连接和持久连接**

²  RTT（Round-trip TIme）：一个小分组从客户机到服务器再回到客户机所花费的时间。

²  非持久连接：每个请求及相应的响应对经一个单独的TCP连接发送。

缺陷：

1)         为每一个请求的对象建立和维护一个全新的连接，对于每个这样的连接，在客户机和服务器都需要分配TCP的缓冲区和变量，给服务器带来严重负担；

2)         每一个对象的传输时延很大（2个RTT）。

²  持久连接：所有请求及相应的响应经相同TCP连接发送。

1)         服务器再发送响应后保持该TCP连接打开；

2)         在相同的客户机与服务器之间的后续请求和相应报文可通过相同的连接进行传送；

3)         一个连接经过一定时间间隔仍未被使用，HTTP服务器将关闭该连接。

**2.2.3 HTTP****报文格式**

²  HTTP报文有两种：请求报文、响应报文。

²  请求报文：

1)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image030.jpg)POST：用户提交表单，输入在实体主体；

2)         GET：输入数据在URL地址中；

3)         HEAD：不返回请求对象，用于故障跟踪；

4)         PUT：将对象上传到指定的Web服务器上指定的路径；

5)         DELETE：删除指定Web服务器上的对象。

 

²  响应报文：

1)         状态行：协议版本、状态码、响应状态信息。

u  状态码：

n   200 OK：请求成功，信息包含在返回的响应报文中；

n   301 Moved Permanently：请求的对象被永久转移，新的URL定义在响应报文的Location：首部行；

n   400 Bad Request：请求不能被服务器理解；

n   404 Not Found：被请求的文档不再服务器上；

n   505 HTTP Version Not Supported：服务器不支持请求报文使用的HTTP协议版本。

**2.2.4****用户与服务器的交互：****cookie**

²  cookie：允许站点跟踪用户。

²  cookie的四个组成部分：

1)         HTTP响应报文中有一个cookie首部行；

2)         HTTP请求报文中有一个cookie首部行；

3)         用户端系统中保留一个cookie文件，，由用户浏览器管理；

4)         Web站点有一个后端数据库。

²  如何cookie跟踪用户：

1)         用户首次访问某站点，第一次发出请求报文；

2)         请求报文到达Web服务器后，服务器产生唯一识别码，并以此作为索引在后端数据库中产生一个表项；

3)         服务器用包含Set-cookie：首部行的HTTP相应报文对Susan的浏览器进行响应；

4)         之后每次用户向服务器发送的请求报文都包括以下首部行cookie：；

5)         这样就实现了服务器对用户的跟踪。

**2.2.5 Web****缓存**

²  Web缓存器也叫代理服务器（proxy server），是能代表初始Web服务器来满足HTTP请求的网络实体。

²  Web缓存器有自己的磁盘存储空间，在该存储空间中保存最近请求过的对象的拷贝。

²  Web缓存器的工作流程：

1)         浏览器建立一个到Web缓存器的TCP连接，并向其发送一个HTTP请求以请求对象；

2)         Web缓存器检查本地是否存储了该对象的拷贝，若有，则用HTTP响应报文向客户机浏览器返回该对象；

3)         若Web缓存器没有该对象，就向初始服务器打开一个TCP连接，请求该对象；

4)         Web缓存器接收到该对象后，在本地存储空间存储一份拷贝，并向浏览器发送该拷贝对象。

²  Web缓存器既是服务器又是客户机。

²  部署Web缓存器的原因：

1)         Web缓存器可以大大地减少对客户机请求的响应时间；

2)         Web缓存器可以大大减少一个机构内部网与因特网接入链路上的通信量；

3)         Web缓存器能从整体上大大降低网上的Web流量，从而改善了所有应用的性能。

**2.2.6****条件****GET****方法**

²  条件请求报文：包含If-modified-since：首部行，保证缓存器中存储的对象拷贝是最新的。

²  服务器响应条件GET时，并不包含所请求对象。原因：不浪费带宽，不增加用户感受到的响应时间。

 

**2.3****文件传输协议：****FTP**

²  FTP会话中，用户通过一台主机，向一台远程主机上传文件或从远程主机下载文件。

²  用户通过一个FTP用户代理与FTP交互。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image032.jpg)

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image034.jpg)FTP用两个并行的TCP连接传输文件：

1)         控制连接：在两个主机之间传输控制信息；

2)         数据连接：实际传输一个文件。

u  控制连接贯穿了整个用户会话期间，针对每次文件传输都需新建一个数据连接。

²  FTP的控制信息是带外（out-of-band）传输：使用一个分离的控制连接。

注：HTTP为带内传输。

²  FTP服务器在整个会话期间保留用户的状态信息。（对每个活动着的用户会话的状态进行追踪，可以对FTP会话总述进行限制）

²  FTP常见命令：

1)         USER username：向服务器发送用户标识

2)         PASS password：向服务器发送口令

3)         LIST：请求服务器返回远程主机上当前目录的所有文件列表

4)         RETR filename：从远程主机的当前目录检索文件。触发远程主机建立一个数据连接，并在该数据连接上发送所请求的文件

5)         STOR filename：用于向远程主机的当前目录存放文件

²  FTP典型回答：

1)         331 Username OK，Password required

2)         125 Data connection already open；transfer starting

3)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image036.jpg)425 Can’t open data connection

4)         452 Error writing file

 

**2.4****因特网中的电子邮件**

²  电子邮件系统的组成部分：

1)         用户代理：允许用户阅读、回复、转发、保存和撰写报文；

2)         邮件服务器：是电子邮件系统的核心。每个接收方在某服务器上有一个邮箱，邮箱管理和维护发送给这个用户的报文；

3)         简单邮件传输协议（SMTP）：使用TCP可靠数据传输服务，从发送方的邮件服务器向接收方的邮件服务器发送邮件。

**2.4.1 SMTP**

²  SMTP不使用中间邮件服务器发送邮件（direct transfer），即使这两个服务器位于地球两端。

²  SMTP在25号端口创建TCP连接。

²  传输阶段：

1)         简单握手：SMTP客户机指明发送方和接收方邮件地址；

2)         发送报文：利用TCP连接提供的可靠数据传输将报文从发送邮件服务器传输到接收服务器；

3)         关闭连接。

²  限制邮件报文的主体部分采用简单的7为ASCII码表示。

²  SMTP基本操作：

1)         Alice调用她的邮件代理程序并提供Bob的邮件地址，撰写邮件，通过用户代理发送该邮件；

2)         Alice的用户代理将报文发送给Alice的邮件服务器，在那里报文被放在报文发送队列中；

3)         运行在Alice邮件服务器上的SMTP客户机端发现报文队列中的报文，创建一个到运行在Bob邮件服务器上的SMTP服务器的TCP连接；

4)         握手后，SMTP客户机通过该TCP连接发送Alice的报文；

5)         Bob的邮件服务器上的服务器端接收该报文，Bob的邮件服务器将该报文放入Bob的邮箱中；

6)         Bob方便的时候，调用用户代理阅读该报文。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image038.jpg)

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image040.jpg)SMTP客户机与服务器之间交换报文脚本的例子：

1)         HELO是HELLO的缩写；

2)         HELO、MAIL FROM、REPT TO、DATA、QUIT等命令均是自解释的。

3)         客户机通过发送一个只含一个句点“.”的行，告诉服务器报文结束。

²  与SMTP服务器直接对话：telnet ServerName 25

**2.4.2****与****HTTP****的对比**

²  两者的重要区别：

1)         HTTP是一个拉协议，用户使用HTTP从服务器拉取信息，TCP连接由想获取文件的机器发起；SMTP是一个推协议，TCP连接由要发送文件的机器发起；

2)         SMTP要求每个报文（包括他们的主体）都使用7位ASCII格式，HTTP没有这个限制；

3)         HTTP把每个对象封装到它自己的HTTP响应报文中，而因特网电子邮件把所有报文对象放在一个报文之中；

**2.4.2****邮件报文格式和****MIME**

²  邮件报文格式：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image042.jpg)

²  发送非ASCII文本的内容，发送方的用户代理需在报文中使用附加的首部行，定义在多用途因特网邮件扩展（Multipurpose Internet Mail Extension，MIME）。

1)         Content-Type： 允许接收用户代理对报文采取适当的动作

2)         Content-Transfer-Encoding： 提示接收用户代理该报文主题已经使用ASCII编码，并指出所用的编码类型。

**2.4.4****邮件访问协议**

²  邮件访问使用了客户机/服务器体系结构。

²  邮件访问协议：

1)         第三版的邮局协议（Post Office Protocol-Version 3）

u  特许（authorization）：用户代理发送（明文形式）用户名和口令以鉴别用户。

u  事务处理：用户代理取回报文，可以对报文做删除标记、取消报文删除标记以及获取邮件的统计信息。

u  更新：出现在客户机发出quit命令后，结束POP3会话，这是邮件服务器删除那些被标记为删除的报文。

ü   用户代理为用户配置“下载并删除”或“下载并保留”方式。

ü   “下载并删除”方式的缺陷：在一个端系统读取邮件后，将不能在另一端系统重新收取该邮件。

ü   POP3会话中不携带状态信息。

ü   POP3没有给用户提供任何创建远程文件夹以及为报文指派文件夹的方法。

2)         因特网邮件访问协议（Internet Mail Access Protocol，IMAP）

²  IMAP协议为用户提供创建文件夹以及在文件夹之间移动邮件的命令。

²  IMAP允许用户代理获取报文组件的命令，例如用户代理可以只读取一个报文的报文首部。

²  IMAP服务器维护了IMAP会话的用户状态信息。

²  基于Web的电子邮件：用户代理是普通的浏览器，用户和其远程邮箱之间的通信通过HTTP进行。

 

**2.5 DNS****：因特网的目录服务**

**2.5.1 DNS****提供的服务**

²  域名系统（Domain Name System，DNS）：进行主机名到IP地址的转换。

²  DNS：

1)         分层DNS服务器实现的分布式数据库；

2)         允许主机查询分布式数据库的应用层协议。

²  DNS协议运行在UDP之上，使用53号端口。

²  DNS提供的其他服务：

1)         主机别名：有着复杂主机名的主机可以拥有一个或者多个别名；

2)         邮件服务器别名；

3)         负载分配：在冗余的服务器之间进行负载分配。

**2.5.2 DNS****工作机理概述**

²  集中式DNS服务器的问题：

1)         单点故障：如果该DNS服务器崩溃，整个因特网将随之瘫痪；

2)         通信容量：单个DNS服务器不得不处理所有的DNS查询；

3)         远距离的集中式数据库：单个DNS服务器不可能临近多有查询客户机，远距离查询可能导致严重时延；

4)         维护：DNS中央数据库十分庞大，且需为不断添加的主机而频繁更新。

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image044.jpg)DNS服务器分为三种类型：

1)         根DNS服务器：

2)         顶级域（Top Level Domain，TLD）DNS服务器：

3)         权威DNS服务器：在因特网上具有公共可访问主机的每个组织机构必须提供公共可访问的DNS记录，这些记录将这些主机的名字映射为IP地址，由权威DNS服务器负责保存这些DNS记录。

²  递归查询：被联系的服务器不断递归查询下一可能知道的服务器直至得到答案。

²  迭代查询：服务器返回下一个可查询的服务器名。

²  DNS将能将信息缓存在本地存储器，在一段时间后丢弃缓存的信息。

**2.5.3 DNS****记录和报文**

²  DNS分布式数据库的所有DNS服务器共同存储着资源记录（Resource Record）。

²  资源记录：（Name, Value, Type, TTL）

²  TTL是该记录的生存时间，决定了资源记录应该从缓存中删除的时间。

²  资源记录的类型：

1)         Type=A，则Name是主机名，Value是主机名的IP地址，类型为A的资源记录提供了标准主机名到IP地址的映射。

2)         Type=NS，则Name是域，而Value是知道如何获得该域中主机IP地址的权威DNS服务器的主机名。这个记录用于沿着查询链路进一步路由DNS查询。

3)         Type=CNAME，则Value是别名为Name的**主机**对应的规范主机名。

4)         Type=MX，则Value是别名为Name的**邮件服务器**的规范主机名。

²  DNS报文：

1)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image046.jpg)前12个字节是首部区域；

2)         问题区域：正在进行的查询信息。

u  名字字段：指出正在被查询的主机名字；

u  类型字段：住处正在询问的问题类型。

3)         回答区域：对最初请求的名字的资源记录。

4)         权威区域：其他权威DNS服务器的记录；

5)         附加区域。

²  在DNS数据库中插入记录的过程：

1)         向注册登记机构提供权威DNS服务器和辅助权威DNS服务器的名字和IP地址；

2)         注册登记机构将资源记录输入TLD服务器。

 

**2.6 P2P****应用**

**2.6.1 P2P****文件分发**

²  在P2P文件分发中，每个对等方都能够重新分发其所有的该文件的任何部分，从而协助服务器进行分发。

²  P2P体系结构的扩展性：

1)         变量名简述：

u  us：服务器接入链路的上载速率；

u  di：第i个对等方接入链路的上载速率；

u  di：第i个对等方接入链路的下载速率；

u  F：被分发的文件长度；

u  N：要获得文件拷贝的对等方的数量；

u  Dcs：服务器/客户机体系结构分发时间。

2)         服务器/客户机模型：

服务器需向每个对等方传输一个文件拷贝，因此服务器必须传输NF比特：NF/us

dmin表示下载速率最小的对等方的下载速率，最小分发时间至少为：F/dmin

最小分发时间：Dcs ≥ max（NF/us， F/dmin）

3)         P2P体系结构：

服务器发过一次的比特无需再次发送（对等方可互相重新分发）：F/us

下载速率最小的对等方：F/dmin

系统总的上载能力等于服务器的上载能力加上每个对等方的上载速率，utotal=us+u1+...+un，系统需向N个对等方每个上载F比特，这不可能快于utotal的速率完成：NF/(us + ∑ui)

最小分发时间：DP2P ≥ max { F/us, F/min(di) , NF/(us + Sui) }

 


 

4)         两者比较：

客户机/服务器体系结构：随着对等方数量的增加，分发时间线性增长且无界；

P2P体系结构：分发时间总是小于客户机/服务器体系结构，对任何多的对等方，分发时间总小于1小时。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image048.jpg)

²  BitTorrent

1)         洪流（torrent）：参与**一个特定文件**分发的所有对等方的集合。

2)         基础设施节点，追踪器（tracker）：一个对等方加入洪流时，首先向追踪器注册，并周期性通知追踪器它仍在洪流中。

3)         邻近对等方：与某对等方建立TCP连接的其他所有对等方成为该对等方的邻近对等方。

4)         最稀罕优先（rarest first）：根据她没有的块从邻居中确定最稀罕的块（在她的邻居中拷贝数量最少的文件块），并优先请求那些块。——均衡每个块在洪流中的拷贝数量。    

5)         对换算法：确定邻居的优先权（按当前提供数据的最高熟虑为标准），并持续测量接收比特的速率，确定以最高速率流入的四个邻居最为邻近对等方，然后将文件块发给这四个邻居。每过10秒，她重新计算该速率并可能修改这四个对等方。每过30秒，将随机选择另一个对等方（optimistically unchoke）并向它发送数据块。

**2.6.2****在****P2P****区域中搜索信息（****ppt****上没有，不知道考不考）**

²  集中式索引

1)         具集中式索引的P2P文件共享系统是P2P和客户机/服务器混合体系结构。

2)         缺点：

u  单点故障；

u  性能瓶颈和基础设施费用：集中式服务器必须维护一个庞大的索引，每秒钟对数千次查询做出响应，通信量巨大；

u  侵犯版权：P2P文件共享系统允许用户免费获取受版权保护的内容，可能有法律问题。

²  查询洪泛

1)         完全分布式方法：索引全面地分布在对等方的区域中，每个对等方索引可供共享的文件二步索引其他文件。

2)         覆盖网络：对等方形成的抽象网络。

u  如果对等方X和Y之间维护了一个TCP连接，则X和Y之间有一条边；

u  覆盖网络由活跃对等方和他们之间的边构成；

u  一条边不是一条物理链路，而是一条抽象链路，可能由许多物理链路组成。

3)         扩展性差：查询会传播到覆盖网络中的每个其他对等方，在支撑网络中产生大量流量。

4)         改进——受限查询洪泛：初始查询报文中设置对等方计数字并赋初值，将查询限制在一定范围内（可能无法定位查找的内容）。

5)         如何处理对等方的加入和离开：

假设新对等方X要加入覆盖网络：

u  发现覆盖网络中的其他对等方，让X维护一张对等方的列表（IP地址）或能够联系维护这样列表的跟踪站点；

u  X试图与列表上的对等方建立TCP连接，直到与Y建立连接为止；

u  X向Y发送ping报文，包括对等方记数字段；接收到该报文后，Y向其覆盖网络中的所有邻居转发，这些邻居继续转发直至计数字段为0；

u  若对等Z接收到ping报文，将通过覆盖网络向X回发一个pong报文，包括Z的IP地址；

u  X接收到该pong报文后，将会知道覆盖网络中许多其他对等方的IP地址，因此与之创建TCP连接，进而创建多条边。

²  层次覆盖

1)         并非所有对等方都是平等的：超级对等方、子对等方。

2)         超级对等方维护一个索引，其中包括其子对等方正在共享的所有文件的标示符、有关文件的元数据和保持这些文件的子对等方的IP地址。

3)         超级对等方之间彼此建立TCP连接，形成覆盖网络。

4)         层次覆盖设计利用了对等方的异质性。

²  分布式散列表（Distributed Hash Table，DHT）

1)         产生一个全分布式索引，索引将文件标示符映射到文件位置；

2)         允许用户（原则上）确认文件的所有位置，而不产生过量的搜索流量；

**2.6.3****案例学习：****Skype****的****P2P****因特网电话**

 

**2.7 TCP****套接字编程**

²  网络应用程序的核心：客户机程序和服务器程序。

²  网络应用程序的分类：

1)         网络应用程序，满足RFC所定义的标准协议；

2)         专用的网络应用程序，不必符合任何现有RFC。

**2.7.1 TCP****套接字编程**

²  服务器为了能对客户机程序发起的连接做出响应：

1)         不能处于睡眠状态；

2)         需要有某种类型的门（welcome socket）。

²  在创建TCP连接的三次握手期间，客户机进程敲服务器进程的欢迎之门。当服务器“听”到敲门时，将创建一个新套接字（连接套接字），为某个特定的客户机程序服务。

²  当客户机程序“敲门”时，服务器程序调用WelcomeSocket中的accept（）方法创建新套接字。

²  TCP在客户机进程和服务器进程之间提供可靠**字节流**服务。

**2.7.2****一个****Java****客户机****/****服务器应用程序例子**

**代码见****ppt**

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image049.png)

 

**2.8 UDP****套接字编程**

²  UDP是面向报文的（不面向字节）。

**代码见****ppt**

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image051.jpg)

 

**Chapter 3****：运输层**

**3.1****概述和运输层服务**

**3.1****概述和运输层服务**

²  运输层协议提供逻辑通信。

²  运输层协议在端系统而不是网络路由器实现。

**3.1.1****运输层和网络层的关系**

²  运输层为运行在不同主机上的**进程**提供逻辑通信，网络层为**主机**提供逻辑通信。

²  运输层协议只工作在端系统，将进程的报文移动到网络边缘（即网络层）。

²  运输层协议能提供的服务受到了底层网络协议的限制。（若网络层协议不能为两主机间报文段提供时延和带宽保证，那么运输层协议也不能）

**3.1.2****因特网运输层概述**

²  因特网是一个TCP/IP协议。

²  因特网网络层协议IP：网际协议。

1)         服务模型：“尽力而为”交付服务；

2)         不确保报文段的交付与报文段的按序交付——不可靠服务。

 

**3.2****多路复用和多路分解**

²  多路分解（Multiplexing）：将运输层报文段的数据交付到正确套接字。

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image053.jpg)多路复用（Demultiplexing）：从源主机不同套接字中收集数据块，并为每个数据块封装上首部信息从而生成报文段，然后将报文段传递到网络层。

²  运输层多路复用的要求：

1)         套接字有唯一标识符；

2)         每个报文段有特殊字段指示该报文段所要交付的套接字。

²  周知端口号：0~1023，保留给周知应用层协议。

²  实现多路分解的简单思路：

1)         主机上的每个套接字被分配一个端口号；

2)         报文段到达主机时，运输层检查报文段的目的端口号，定向到相应的套接字；

3)         报文段中的数据经过套接字进入所连接的进程。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image055.jpg)

²  无连接的多路复用和多路分解

1)         UDP套接字由包含目的IP地址和目的端口号的二元组全面标识。

2)         若两个UDP报文段源报文段和/或源端口号不同，但目的IP地址和目的端口号相同，那么它们将通过相同的目的套接字定向到相同的目的进程。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image057.jpg)

²  面向连接的多路复用和多路分解

1)         TCP套接字由四元组标识：源IP地址、源端口号、目的IP地址、目的端口号。

2)         若两个UDP报文段源报文段和/或源端口号不同，但目的IP地址和目的端口号相同，那么它们将通过相同的目的套接字定向到两个不同套接字。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image059.jpg)

²  Web服务器与TCP

1)         连接套接字与进程间并非总是一一对应的关系。

2)         当今的高性能Web服务器通常只使用一个进程，但是为每个新的客户机连接创建一个具有新连接套接字的新线程。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image061.jpg)

 

**3.3****无连接运输：****UDP**

²  UDP被称为无连接的原因：发送报文段之前，发送方和接收方的运输层实体之间没有进行握手。

²  选择在UDP上构建应用的原因：

1)         应用层能更好的控制要发送的数据和发送时间：只要应用进程将数据传递给UDP，UDP就会将数据打包成UDP报文段并立即传递给网络层；

2)         无需连接建立：UDP不会引入建立连接的时延；

3)         无连接状态：不维护连接状态，也不跟踪这些参数，以便能支持更多的活动客户机；

4)         分组首部开小小。

²  75%的按需和实况流式媒体使用了TCP的原因：分组丢包率低、某些机构为了安全阻塞UDP流量。

²  UDP中缺乏拥塞控制机制，可能导致UDP发送方和接收方之间的高丢包率，击垮TCP会话。

²  使用UDP的应用是可以实现可靠数据传输的：通过在应用程序自身中建立可靠性机制来完成（如增加确认与重传机制）。但可能需要较长时间调试。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image063.jpg)**3.3.1 UDP****报文结构**

 

 

²  接收主机使用检验和（checksum）检查报文段是否有差错。

²  长度字段指明包括首部在内的UDP报文段长度。

 

**3.3.2 UDP****检验和**

²  发送方对UDP对报文段中的所有16比特字的和进行反码运算，求和时遇到的任何溢出均被回卷，得到的结果就是UDP检验和。

²  简单例子：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image065.jpg)

²  UDP提供差错检测，但不提供差错恢复。

 

**3.4****可靠数据传输的原理**

²  服务抽象：数据可以通过一条可靠信道传输。（实际上可靠信道的下层协议也许是不可靠的）

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image067.jpg)（数据通过可靠信道传输）

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image069.jpg)（可靠信道的下层协议也许不可靠）

**3.4.1****构造可靠数据传输协议**

²  完全可靠信道上的可靠数据传输：rdt1.0

1)         考虑底层信道是完全可靠的。

2)         FSM：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image071.jpg)

²  具有比特差错信道上的可靠数据传输：rdt2.0

1)         假定所有分组按序接收，但可能有比特差错。

2)         **使用肯定确认和否定确认。**

3)         自动重传请求（Automatic Repeat reQuest）：接收到否定确认时自动重传。

4)         ARQ协议处理比特差错：

u  差错检测：需要一种机制检测何时出现了比特差错。

u  接收方反馈：ACK、NAK。

u  重传：接收方接收到有差错的分组时，发送方重传。

5)         FSM：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image073.jpg)

6)         rdt2.0被称为停等（stop-and-wait）协议：发送方不会发送一块新数据，直到发送方确信接收方已接收当前分组。

7)         rdt2.0的问题：ACK和NAK分组可能受损。处理受损的ACK或NAK：

u  发送方接到受损的确认分组时，回复“你说什么”，说话者复述该回复。但可能“你说什么”再次受损，接受者将不明白这个受损的分组是口述内容的一部分还是要求重复上次回答。困难重重。

u  增加足够的检验和比特，使发送方不仅可以检测差错，还可以恢复。

u  重发当前分组——引入**冗余分组****(duplicate packet)**。冗余分组的困难：接收方不知道上次传输的ACK或NAK是否被正确收到，因此无法知道当前接收到的分组是新的还是一次重传。

8)         rdt2.1：引入对数据分组的编号（对于停等协议，1比特的序号足够）。FSM见ppt。

u  收到失序分组：对所接受分组发送肯定确认；

u  收到受损分组：对所接受分组发送NAK；

u  不发送NAK，而是发送对上次正确接收分组的ACK：与收到NAK效果一样（冗余ACK）。

9)         rdt2.2：无NAK的可靠数据传输协议。

u  接收方：包括一个由ACK报文确认的分组序号；

u  发送方：检查接收到的ACK报文中所确认的分组序号。

²  具有比特差错的丢包信道上的可靠数据传输：rdt3.0（比特交替协议）

1)         倒计数定时器：在一个给定的时间过期后，可中断发送方。

2)         发送方需要能做到：

u  每发送一个分组（即第一次分组和重传分组）时，启动一个定时器；

u  响应定时器中断；

u  终止定时器。

**3.4.2****流水线可靠数据传输协议**

²  停等协议的有效吞吐量十分低。

²  采用流水线可靠数据传输协议提高有效吞吐量：

1)         增加序号范围；

2)         发送方和接收方需要可以缓存多个分组。

 

**3.4.3****回退****N****步**

²  回退N步（Go-Back-N）协议（又被称为滑动窗口协议）中，允许发送方发送多个分组（当有多个分组可用时）而不需等待确认。在流水线中未确认分组不能超过某个最大允许数N。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image075.jpg)

²  GBN**发送方**必须响应三种类型的事件：

1)         上层的调用：上层调用rdt_send时，发送方首先检查发送窗口是否已满，即是否有N个已发送但未被确认的分组，如果未满，则发送分组，否则发送方返回数据给上层，隐式的通知上层。实际操作中，发送方更可能做的是缓存分组，或使用同步机制——仅当发送窗口未满时允许上层调用。

2)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image077.jpg)收到ACK：对序号为n的分组采取累积确认的方式，表明接收方已正确接收n以前的所有分组。

3)         超时事件：如果出现超时，则发送方重传所有已发送但未经确认的分组。

²  GBN**接收方**：如果一个序号为n的分组被正确接收，且按序，则接收方为分组n发送一个ACK，并将分组中的数据交付到上层。在所有其他情况下，接收方都将丢弃该分组。（注意：如果分组k已接收并正确交付，则所有序号比k小的分组都已经交付）

²  GBN协议中接收方不需要缓存任何失序分组（发送方察觉后会全部重传），唯一需要维护的信息就是下一个按序接收的分组序号。

²  GBN协议的问题：一个单个分组的差错就可能引起GBN重传大量分组。

**3.4.4****选择重传**

²  选择重传（Selective Repeat）协议通过让发送方仅重传那些它怀疑在接收方出错（即丢失或受损）的分组而避免了不必要的重传。

²  SR**发送方**：

1)         从上层收到数据：收到数据后，检查下一个可用于该分组的序号。如果序号在发送方窗口内，则将数据打包并发送；否则将数据缓存或返回上层。

2)         超时：每个分组拥有自己的逻辑定时器。

3)         收到ACK：收到ACK且分组序号在窗口内时，SR发送方将这个被确认的分组标记为已接收。若该分组序号等于send_base，则窗口序号向前移动到具有最小未确认分组处。如果窗口移动了并且有序号落在窗口内的未发送分组，则发送这些分组。

²  SR**接收方**：

1)         序号在[rcv_base, rcv_base+N-1]内的分组被正确接收：收到的分组落在接收方的窗口内，一个ACK分组被发回给发送方。

u  若分组在之前未被接收过，则被缓存；

u  若该分组的序号等于接收窗口的基序号，则该分组以及以前缓存的序号连续的分组（交付给上层）。

2)         序号在[rcv_base-N, rcv_base-1]内的分组被正确接受到，产生ACK，即使该分组是接收方以前确认过的分组。

3)         其他情况，忽略该分组。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image079.jpg)

²  SR协议中，窗口长度必须小于等于序号空间大小的一半。

 

**3.5****面向连接的运输：****TCP**

**3.5.1 TCP****连接**

²  TCP概览：

1)         点到点（point-to-point）：TCP连接是单个发送方和单个接收方的连接（多播：一次发送操作中，一个发送方将数据传送给多个接收方）；

2)         可靠、有序的字节流（byte stream）；

3)         TCP连接的每一端都有发送缓存和接受缓存；

4)         TCP连接提供全双工服务（full duplex data）：应用数据可以从进程B流向进程A的同时，从进程A流向进程B；

5)         面向连接：应用进程彼此发送数据前，必须相互“握手”，建立连接；

6)         流量控制：发送方与接收方的数据传输速度处于平衡状态（sender will not overwhelm receiver）。

²  最大报文段长（maximum segment size， MSS）。

 

**3.5.2 TCP****报文段结构**

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image081.jpg)TCP通常是将文件划分成长度为MSS的若干文件块。

²  TCP报文段结构：

1)         源端口号、目的端口号：用于多路复用/多路分解；

2)         序号字段（32bits）、确认号字段（32bits）；

3)         接收窗口字段：用于流量控制；

4)         首部长度字段：指示首部长度；

5)         选项字段：可选且长度可变，用于发送方和接收方协商最大报文段长度，或在高速网络环境下用作窗口调节因子；

6)         标志字段：

u  ACK：指示确认字段中的值是有效的；

u  RST、SYN、FIN：用于连接建立和拆除；

u  PSH：指示接收方应立即将数据交给上层；

u  URG：指示报文段里存在着被发送方的上层实体置为“紧急”的数据。

7)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image083.jpg)紧急数据指针字段：当紧急数据存在并给出紧急数据尾的指针时，TCP必须通知接收方的上层实体。

²  序号和确认号：

1)         TCP把数据看成一个无结构但是有序的字节流。

2)         TCP的序号建立在传送的字节流之上而不是传送的报文段序列之上。

3)         一个报文段的序号是报文段首字节的字节流编号。

4)         主机A填充进报文段的确认号是主机A期望从主机B收到的下一字节的序号。

5)         TCP提供累计确认。

**3.5.3****往返时延的估计和超时**

这部分看书就好。

**3.5.4****可靠数据传输**

²  TCP发送方必须处理的三个主要事件：

1)         从上层应用程序接收数据；

2)         定时器超时：通过重传引起超时的报文段来响应超时；

3)         收到ACK报文：将ACK的值y与SendBase（最早未确认的字节序号）进行比较

u  y > SendBase：确认一个或多个之前未经确认的报文段（累计确认）；

u  如果当前还有未经确认的报文段，重启定时器。 

²  产生TCP ACK的建议：

| 事件                                                         | TCP接收方动作                                                |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 所期望序号的报文段按序到达，所在期望序号及其以前的数据都已经被确认。 | 延迟的ACK。对另一个按序报文段的到达最多等待500ms，如果在此时间间隔中下一报文段没有到达，则发送一个ACK。 |
| 有期望序号的报文段按序到达。另一个按序报文段等待ACK传输。    | 立即发送单个累计ACK，以确认两个按序报文段。                  |
| 比期望序号大的失序报文段到达，检测出数据流中的间隔。         | 立即发送冗余ACK，指明下一个期待字节的序号（该间隔的低端字节序号） |
| 能部分或完全填充接收数据间隔的报文段到达                     | 倘若该报文段起始于间隔的低端，则立即发送ACK。                |

²  一旦收到3个冗余ACK，TCP就执行快速重传，即在该报文段的定时器过期之前重传丢失的报文段。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image085.jpg)**3.5.5****流量控制**

²  流量控制是一个速度匹配服务，即发送方的发送速率与接收方应用程序的毒素率相匹配。

²  接收窗口：用于告诉速度发送方接收方还有多少可用的缓存空间。

**3.5.6 TCP****连接管理**

²  客户机向服务器请求建立TCP连接（三次握手）：

1)         客户机→服务器：发送SYN=1，含初始序号的报文段；

2)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image087.jpg)服务器→客户机：为该TCP连接分配TCP缓存和变量，并向客户机发送允许连接的报文段；SYN被置为1，服务器选择初始序号；

3)         客户机→服务器：客户机为该TCP连接分配缓存和变量，然后向服务器发送另外一个报文段，对服务器允许连接的报文段进行确认，SYN被置为0。

²  TCP连接终止的步骤：

1)         客户机→服务器：FIN=1；

2)         服务器→客户机：发送确认报文段；

3)         服务器→客户机：发送终止报文段，FIN=1；

4)         客户机→服务器：对服务器的终止报文段进行确认。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image089.jpg)**3.6****拥塞控制原理**

²  分组重传是网络拥塞的征兆。

**3.6.1****拥塞原因与开销**

²  两个发送方和一个具有无穷大缓存的路由器：

u  主机A和主机B向路由器提供流量的速率均为λin。

u  吞吐量与发送速率的关系：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image091.jpg) 

（看似是是好事，因为分组在被交付到目的地的过程中链路被充分利用了）

u  时延与发送速率的关系：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image093.jpg)

（网络拥塞的开销：当分组到达速率接近链路容量时，分组将经历巨大排队时延）

²  两个发送方和一个具有有限缓存的路由器：

u  有限缓存的路由器：分组到达已满的缓存时会被丢弃。

u  假定：

1)         λin：应用程序将初始数据发送到套接字的速率；

2)         λin’：运输层向网络层中发送报文段的速率。

u  发送方的重传策略：仅当确定了一个分组丢失时才重传。

u  网络拥塞的开销：发送方必须执行重传以补偿因为缓存溢出而丢弃（丢失）的分组。

²  四个发送方、具有有限缓存的多台路由器和多跳路径：

 ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image095.jpg)       ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image097.jpg)

u  网络拥塞的开销：一个分组沿一条路径被丢弃时，每个上游路由器用于转发该分组到丢弃该分组而使用的传输流量最终被浪费掉了。

**3.6.2****拥塞控制方法**

²  端到端拥塞控制：

u  网络层没有为运输层拥塞控制提供显式支持；

u  端系统需要对网络行为进行观察以察觉拥塞的存在，例如检测到TCP报文段的丢失。

²  网络辅助的拥塞控制：

u  网络层组件（即路由器）向发送方提供关于网络中拥塞状态的显式反馈信息。

1)         网络路由器发送给发送方直接反馈信息：阻塞分组。

2)         路由器标记或更改从发送方流向接收方的分组中的某个字段来标识拥塞的产生。（至少要经过一整个往返时间）

**3.6.3****网络辅助的拥塞控制例子：****ATM ABR****拥塞控制**

²  资源管理信元：用于在主机和交换机之间传递和拥塞相关的信息。

²  当RM信元到达目的地时，它将被调转方向回送给发送方（内容可能已经更改）。交换机也可直接产生信元，并将其**直接**发送给源。（也即分为直接网络反馈和经由接收方的网络反馈）

²  ATM ABR是一种基于速率的办法：发送方明确计算出它所能发送的最大速率，并据此对自己进行调整。

²  ABR提供的三种机制：

u  EFCI比特：数据信元包含1比特的显式转发拥塞指示比特，如果多数到达的数据信元中数据信元中此比特都为1，则目的地将资源管理信元中的拥塞指示（CI）比特置为1，并发送给发送方，使发送发得知网络拥塞。

u  CI和NI比特：拥塞指示（CI）和无增长（NI）比特可被一台拥塞的交换机设置。特别的，交换机在轻微拥塞时将经过的RM信元中的CI比特置为1，在严重拥塞的情况下把NI比特置为1。

u  ER：显式速率字段。拥塞的交换机也许会降低经过的RM信元总ER的值，在这种方式中，ER字段被设置为在源至目的地的路径上的所有交换机中的最小可支持速率。

 

**3.7 TCP****拥塞控制**

²  TCP拥塞控制机制让每一端都记录一个额外的变量：拥塞窗口（congestion window），对TCP发送方能向网络中发送流量的速率进行了限制。**特别是，一个发送方中未被确认的数据量不会超过****CongWin****和****RcvWindow****中的最小值。**

²  TCP使用确认来触发（或计时）它的拥塞窗口长度的增大，所以TCP被称为是自计时的。

²  TCP拥塞控制算法：

u  加性增，乘性减

1)         乘性减：每发生一次丢包时间就将当前的CongWin减半。（但是不能低于一个MSS）

2)         加性增：每次收到一个确认后就把CongWin增大一个MSS——每个往返时延内CongWin增大一个MSS。

3)         避免拥塞（congestion avoidance）：TCP拥塞控制协议的线性增长阶段。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image099.jpg)

（加性增、乘性减使得长寿命的TCP连接的CongWin变化呈锯齿形状）

u  慢启动

1)         慢启动：TCP发送方以慢速率发送，但是以指数的速率增加其发送速率。

2)         慢启动的原因：TCP发送发初始速率很慢，但可用带宽可能比这个速率大得多，若仅仅线性增加发送速率，在发送速率增加到某个可观的级别可能会经历很长时间。

u  对超时时间做出反应

1)         收到三个冗余ACK：拥塞窗口长度减小一半。

2)         超时：TCP发送方进入慢启动阶段，将拥塞窗口设置为1MSS，然后窗口长度以指数速度增长，直到拥塞窗口达到超时前窗口值的一半为止。

3)         阈值（Threshold）：确定慢启动将结束并且拥塞避免开始的窗口长度。

v  每发生一个丢包事件，Threshold被设置为**当前****CongWin****值**的一半。

²  对TCP Reno拥塞控制算法的讨论：

| 状态           | 事件                         | TCP发送方拥塞控制动作                                        | 注释                                          |
| -------------- | ---------------------------- | ------------------------------------------------------------ | --------------------------------------------- |
| 慢启动（SS）   | 收到前面未确认数据的ACK      | CongWin=CongWin+MSS   If(CongWin>Threshold)设置状态“拥塞避免” | 每过RTT，   CongWin翻倍                       |
| 拥塞避免（CA） | 收到前面未确认数据的ACK      | CongWin=CongWin   +MSS*MSS/CongWin                           | 加性增，每过RTT使CongWin增加1个MSS            |
| SS或CA         | 由3个冗余ACK检测到的丢包事件 | Threshold=CongWin/2   CongWin=Threshold+3   设置状态拥塞避免 | 快速恢复，实现乘性减。CongWin将不低于1个MSS。 |
| SS或CA         | 超时                         | Threshold=CongWin/2   CongWin=1   设置状态慢启动             | 进入慢启动                                    |
| SS或CA         | 冗余ACK                      | 对确认的报文段增加冗余ACK计数                                | CongWin和Threshold不变                        |

²  TCP Tahoe：无论是收到3个冗余ACK还是超时，一律ssthresh = cwnd/2   cwnd=1，然后进入慢启动

²  快速恢复：收到三个冗余ACK后重新开始慢启动阶段的行为。

²  TCP吞吐量的宏观描述：

一个连接的平均吞吐量： 0.75*W / RTT （W：丢包时的拥塞窗口长度）

²  UDP源压制TCP流量的现象可能发生——开发研究因特网拥塞控制机制，阻止UDP流量压制直至中断因特网吞吐量。

 

**第四章** **网络层**

**4.1****概述**

²  路由器的主要作用：将数据包从入链路转发到出链路。

**4.1.1****转发和选路**

²  网络层功能：

1)         转发：分组从一个输入链路接口转移到适当的输出链路接口的路由器本地动作。

2)         选路：分组从源到目的地时，决定端到端路径的网络范围的进程。

3)         连接建立：某些网络层体系结构而非因特网，要求从源到目的地沿着所选择的路径彼此握手，以便在网络层数据分组开始流动之前，给定的源到目的地之间建立起连接状态。

**4.1.2****网络服务模型**

²  网络层提供的特定服务：

1)         确保交付；

2)         具有时延上界的确保交付；

3)         有序分组交付；

4)         确保最小带宽；

5)         确保最大时延抖动：确保发送方发送的两个相继分组之间的时间量等于在目的地接收到它们之间的时间量；

6)         安全性服务。

 

**4.2****虚电路和数据包网络**

²  网络层连接和无连接服务与运输层连接和无连接服务的区别：

1)         在网络层中，这些服务是主机到主机之间的服务；在运输层中，这些服务是进程到进程之间的服务。

2)         在网络层中，不同时提供连接和无连接服务；而在运输层中，可同时提供这两种服务。

3)         运输层面向连接服务仅在网络边缘的端系统中实现；网络层的连接服务除了在端系统中实现，还在位于网络核心的路由器中实现。

**4.2.1****虚电路网路**

²  虚电路的组成：

1)         源和目的主机之间的路径（一系列链路和路由器）；

2)         VC号，沿着该路径的每段链路一个号码；

3)         沿着该路径的每台路由器的转发表表项。

²  为什么一条分组沿着其路由在每条链路上不能保持相同的VC号：

1)         逐链路代替该号码减少了分组首部中的VC字段的长度；

2)         简化虚电路的建立。

**若沿着某路径的所有链路需要一个共同的****VC****号的话，路由器将不得不交换并处理大量的报文，以约定一个共同的****VC****号。**

²  在虚电路网络中，路由器必须为进行中的连接维持连接状态信息。

1)         每当建立一个新连接，将一个新的连接项加到该路由器转发表中；

2)         每当释放一个连接，从该表中删除该表项。

²  虚电路建立的三个阶段：

1)         虚电路建立：

u  发送运输层与网络层联系，指定接收方地址；

u  网络层决定发送方与接收方之间的路径

u  网络层为每条链路确定一个VC号；

u  网络层在沿着路径的每条路由器的转发表中增加一项；

u  虚电路连接期间，网络层预留虚电路路径上的资源（如带宽）。

2)         数据传送；

3)         虚电路拆除：

u  网络层通知网络另一侧的端系统结束呼叫；

u  更新路径上每台路由器中的转发表。

²  运输层的连接建立仅涉及两个端系统，网络中的路由器对这个连接其实毫不知情。

²  网络层中的虚电路建立时，不仅端系统参与虚电路建立，且每台路由器都知道经过它的所有虚电路。

²  信令报文：端系统向网络发送指示虚电路启动与终止的报文，以及路由器之间传递的用于建立虚电路（即修改路由器表中的连接状态）的报文。

²  信令协议：用来交换信令报文的协议。

**4.2.2****数据报网络**

²  数据报网络无需建立任何虚电路，路由器不维护任何有关虚电路的有关信息。

²  分组从源到目的地的传输过程中，每台路由器通过转发表将目的地址映射到输出链路——通过将目的地址的**前缀**与转发表中的表项相匹配。

²  最长前缀匹配规则：在转发表中寻找最长的匹配项。

²  数据报网络中的路由器不维持**连接状态信息**，但在其转发表中维持了**转发状态信息**。

²  数据报网络中的转发表周期性更新，因此从一个端系统到另一个端系统的一系列分组可能在通过网络时走不通的路径，并可能无序到达。

**4.2.3****虚电路和数据报网络的由来**

 

**4.3****路由器工作原理**

²  路由器的组成部分：

1)         输入端口：

u  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image101.jpg)将一条输入的物理链路端接到路由器的物理层功能；

u  执行需要与位于入链路远端的数据链路层功能交互的数据链路层功能；

u  完成查找与转发功能。

2)         交换结构：将输入端口连接到输出端口，是一台路由器中的网络。

3)         输出端口：执行与输入端口相反的物理层功能。

4)         选路处理器：

u  选路处理器执行选路协议；

u  维护选路信息于转发表；

u  执行路由器中的网络管理功能。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image103.jpg)**4.3.1****输入端口**

²  通常一份转发表的影子拷贝将被存放在每个输入端口，且更新——可在输入端口做出转发决策，而不调用中央选路处理器。

²  人们希望输入端口的处理速度能够达到线路速度，即执行一次查找的时间应少于从输入端口接收一个分组所需的时间。

²  分组可能会在进入交换结构时暂时阻塞——由于来自其他输入端口的分组当前正在使用该交换结构。

**4.3.2****交换结构**

²  通过交换结构，分组从输入端口转发到输出端口。

²  交换技术：

1)         经内存交换：输入端口到输出端口之间的交换是在CPU（选路处理器）的直接控制下完成。输入端口和输出端口类似于传统操作系统中的I/O设备。

2)         经一根总线交换：输入端口经一根共享总线将分组直接传送到输出端口，不需选路处理器的干预。——一次只能有一个分组通过总线传送，路由器的交换带宽受总线速率的限制。

3)         经一个互联网络交换：一个到达某个输入端口的分组沿着输入端口的水平总线串行，直至该水平总线与连到所希望的输出端口的垂直总线的交叉点。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image105.jpg)

**4.3.3****输出端口**

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image107.jpg)

**4.3.4****何时出现排队**

²  输入端口和输出端口处都能形成分组队列。

²  分组丢失的实际位置取决于流量负载、交换结构的相对速率和线路速率。

²  在输出端口产生丢包：当交换结构到达输出端口的分组速度大于输出端口的线性速度，分组缓存，持续缓存直至超过输出端口缓存时，产生丢包。

²  线路前部阻塞（Head-Of-the-Line，HOL）：在一个输入队列中排队的分组必须等待通过交换结构发送（即使输出端口是空闲的）。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image109.jpg)

**4.4****网络协议：因特网中的转发和编址**

²  因特网网络层组件：

1)         IP协议；

2)         选路组件：决定数据报从源到目的地所流经的路径；

3)         报告数据报中的差错和对某些网络层信息请求进行响应的设施。

**4.4.1****数据报格式**

²  IPv4数据报中的关键字段：

1)         版本号：规定数据报IP协议的版本，不同的IP版本使用不同的数据报格式。

2)         首部长度：由于IPv4包含一些可选项，故需用首部4个比特确定IP数据报中的数据部分实际的开始位置。

3)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image111.jpg)服务类型：区别不同类型的IP数据报，例如将实时数据报与非实时流量区分开。

4)         数据报长度：首部长度加上数据长度，IP数据报理论上最大的长度为65535.

5)         标识、标志、片偏移：与IP分片有关。

6)         寿命（Time-To-Live，TTL）：确保数据报不会永远在网络中循环。每经过一台路由器，TTL值减1，直到该值为0时，该数据报必须丢弃。

7)         协议：协议号的作用类似于运输层报文段中端口号字段的作用，是将网络层与运输层绑定到一起的粘合剂——指明了IP数据报的数据部分应交给哪个运输层协议。协议号为6——TCP，协议号为17——UDP。

8)         首部检验和：帮助路由器检测收到的IP数据报中的比特错误。**计算方法：**每两个字节当作一个数，用反码运算对这些数求和。**路由器一般会丢弃出错的数据报。**

9)         源和目的IP地址：源IP字段插入源主机的IP地址，目的IP地址字段插入最终目的地址。

10)      选项。

11)      数据（有效载荷）：包含要交付给目的地的运输层报文段，也可承载其他类型的数据，如ICMP报文段等。

²  IP数据报分片：

1)         并不是所有链路层协议都能承载长度相同的网络层分组（有些协议可以承载大分组，而有些协议只能承载小分组）。

2)         最大传输单元（Maximum Transmission Unit，MTU）：链路层帧能承载的最大数据量。

3)         数据报的重新组装工作在端系统而非路由器中完成——确保路由器的性能，降低工作复杂性。

4)         组装数据报的具体做法：

u  标识（identification）：在数据报设置源和目的地址的同时加上标识号，发送主机发送的每个数据报中的标识号加一；

u  标志（flag）：数据报需要分片时，形成的数据报附加上初始数据报的源地址、目的地址和标识号。为确保目的主机绝对相信接收到初始数据报的最后一个片，将一个片的标志号设置为0，其他数据报的标志号设置为1。

u  偏移字段（offset）：指定片应放在初始IP数据报的哪个位置——确定一个片是否丢失。

5)         在目的地，数据报的有效载荷仅在IP层已完全重构为初始IP数据报时，才被传递给目的地运输层。

6)         分片的问题：

u  使路由器和端系统更为复杂，即必须将数据包分成适当大小的片并且需要重新组装；

u  可能引发致命的DoS攻击，例如Jolt2攻击、发送交迭的IP分片等等方式。

**4.4.2 IPv4****编址**

²  接口（interface）：主机与物理链路之间的边界、路由器与它的任意一条链路之间的边界。

1)         路由器有多个接口；

2)         主机只有唯一接口；

3)         每个接口都拥有自己的IP地址。

²  点分十进制记法（dotted-decimal notation）：地址中的每个字节用十进制形式书写，各字节间以句号（点）隔开。

²  子网：

1)         具有相同子网掩码（IP地址的高字节）的设备接口；

2)         在同一子网中的设备可通过一个不包含路由器的网络互连起来。

²  为了确定子网，分开主机和路由器的每个接口，从而产生了几个分离的网络岛，接口端接了这些独立的网络的端点。这些独立的网络中的每一个都叫做一个子网。

²  因特网的地址分配策略——无类别域间选路（Classes Interdomain Routing，CIDR），IP地址被划分为两部分：a.b.c.d/x，其中x指示了在地址的第一部分中的比特数。

²  IP广播地址：255.255.255.255——主机发出一个目的地址为255.255.255.255的数据报时，该报文会被交付到同一个子网中的所有主机。

²  设备如何从本组织地址块中分配到一个地址：

1)         获取一块地址：

u  与ISP联系获取一组地址；

u  因特网名字与号码分配机构分配地址——分配IP地址，管理DNS根服务器，分配域名与解决域名纷争。

2)         获取主机地址：动态主机配置协议：

u  路由器中的IP地址：系统管理员手工配置；

u  主机IP地址：动态主机配置协议（Dynamic Host Configuration Protocol， DHCP），又称为即插即用协议（plug-and-play protocol）。

v  主机可自动获取IP地址，且通过配置DHCP，主机可在每次连接网络时获取相同或临时IP地址。

v  DHCP允许一台主机获取其他信息，例如子网掩码、第一条路由器地址（默认网关）、本地DNS服务器地址等。

v  DHCP服务器需更新其可用IP地址表——主机加入时，服务器从当前可用地址池分配一个任意地址给它；主机离开时，其地址被回收到池中。

v  DHCP是客户机/服务器协议——客户机通常是新到达的主机，服务器时DHCP服务器或DHCP中继代理（通常为路由器）。

v  DHCP协议工作的四个步骤：

**a.**          **DHCP****服务器发现**——新到达主机寻找一个与其交互的DHCP服务器。**方法：**客户机生成包含DHCP发现报文的IP数据报，使用广播目的笛子255.255.255.255并且使用源地址0.0.0.0，将其广播到所有与该子网连接的子网。

**b.**         **DHCP****服务器提供**——DHCP服务器接收到DHCP发现报文时，使用IP广播地址发送DHCP提供报文。提供报文中含有收到的发现报文的事务ID、向客户机推荐的IP地址、网络掩码以及IP地址租用期（IP address lease time，即IP地址有效的时间量）。

**c.**          **DHCP****请求**——新到达主机从一个或多个服务器中选择一个，并用一个DHCP请求报文对选中的服务器进行响应，回显配置参数。

**d.**         **DHCP ACK**——服务器响应DHCP请求报文，证实所要求的参数。

3)         网络地址转换（NAT）：

u  具有专用地址的地域：地址仅对网络中的设备有意义的网络。

u  NAT路由器对外界的行为如同一个具有单一IP地址的单一设备。

u  使用NAT的原因：

v  不再需要ISP分配一块连续地址，对所有设备仅使用一个IP地址；

v  可以再不通知外界的情况下改变内网中设备的IP地址；

v  可以再不改变内部设备地址的情况下更改ISP；

v  内网中的设备将不被外界显示的定位查找（安全性考虑）。

u  NAT转换表：包含端口号和IP地址。

u  NAT路由器的工作过程：

v  用户向LAN中发送数据报：NAT路由器收到该数据报，为该数据报生成一个新的端口号，将其源IP地址修改为广域网一侧接口的UP地址，且将源端口号换为生成的新端口号；

v  NAT路由器在其转发表中新增这一项转换记录；

v  当数据报被发回切到达NAT路由器时，路由器使用当前数据报中的IP地址与端口号在转发表中进行检索，将其更换为内网中该设备的正确IP地址与端口号，向该设备发送数据报。

u  NAT备受争议：

v  端口号适用于编址进程而非主机；

v  路由器应当处理最多达第三层的分组；

v  NAT协议违反了所谓端到端原则，主机间应相互直接对话，而不应介入修改IP地址与端口号；

v  应使用IPv6来解决IP地址短缺的问题，而不是不计后果的使用NAT之类的权宜之计。

4)         UPnP

u  UPnP：允许主机发现并配置邻近NAT的协议。

u  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image113.jpg)使用UPnP，一台主机上的应用程序能够为某些请求的公共端口号请求一个NAT映射，该映射位于（专用IP地址，专用端口号）和（公用IP地址，公用端口号）之间。如果NAT接受该请求并生成该映射，则来自外部的节点能够发起到（公用IP地址，公用端口号）的TCP连接。

**4.4.3 ICMP****：互联网控制报文协议**

²  ICMP：用于主机和路由器彼此交互网络层信息。

²  ICMP最典型的用途是差错报告。

²  ICMP报文：

1)         类型字段。

2)         编码字段。

3)         引起该ICMP报文首次生成的IP数据报。

²  Traceroute通过ICMP报文实现，具体见书P230。

**4.4.4 IPv6**

²  IPv6数据报格式：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image115.jpg)

²  IPv6引入的变化在其数据报格式中：

1)         扩大的地址容量：IP地址长度从32比特增长到128比特。引入**任播地址**——使一个数据报能交付到一组主机中的任意一个。

2)         简单高效的40字节首部。

3)         流标签与优先级：流标签——给属于特殊流的分组加上标签，这些特殊流是发送方要求进行特殊处理的流，如一种非默认服务质量或需要实时服务的流。

²  IPv6中定义的字段：

1)         版本号；

2)         流量类型；

3)         流标签；

4)         有效载荷长度；

5)         下一个首部：标识数据报中的内容需要交付给哪个协议；

6)         跳限制：转发数据报的每台路由器对该字段的内容减1；

7)         源和目的地址；

8)         数据。

²  IPv6不允许在上对路由器进行分片和组装。若数据报因太大而无法转发到输出链路上，该数据报将被丢弃，且路由器向发送发发回一个“分组太大”的ICMP差错报文即可。

²  从IPv4向IPv6的迁移：

1)         宣布一个标志日，关闭所有机器进行升级；

2)         双栈（dual-stack）：IPv6节点也具有完整的IPv4实现，这样的节点具有发送和接收两种数据报的能力。但当发送方和接收方其中一个仅是IPv4使能时，只能使用IPv4数据报。

3)         建隧道（tunneling）：隧道——假定两个IPv6节点要使用IPv6数据报进行交互，但它们之间是经由中间IPv4路由器而互连的，则中间IPv4路由器集合被称为隧道。**具体做法：**在隧道发送端的IPv6节点，将整个IPv6数据报放到一个IPv4数据报中，到达隧道接收端时，IPv6节点再从中取出IPv6数据报。

**4.4.5 IP****安全性概述**

 

**4.5****选路算法**

²  选路算法在网络路由器中运行、交换和计算，以配置路由器中转发表的信息。

²  默认路由器（default router），或称第一条路由器（first-hop router）：与主机直接相连接的路由器。

²  源/目的路由器（source/destination router）：源/目标主机的默认路由器。

²  广义上的一种选路算法分类：

1)         全局选路算法：以所有节点之间的连通性及所有链路的费用为输入。通常又可成为链路状态（Link-State）算法。

2)         分布式选路算法：以迭代的、分布式的方式计算出最低费用路径。每个节点仅有与其直接相连链路的费用知识即可开始工作，通过迭代计算过程并与相邻节点交换信息，一个节点逐渐计算出到达目的节点或一组目的节点的最低费用路径。

²  广义上的一种选路算法分类：

1)         静态选路算法：随时间推移，路由的变化非常缓慢，通常由于人工干预调整。

2)         动态选路算法：能够在网络流量负载或拓扑发生变化时改变选路路径，可周期性地运行或直接地响应拓扑或链路费用的变化而运行。

²  广义上的一种选路算法分类：

1)         负载敏感算法：链路费用动态变化以反映出底层链路的当前拥塞水平。

2)         负载迟钝算法：某条链路的费用不明显地反映当前（或最近）拥塞水平。

**4.5.1****链路状态选路算法**

²  获知网络拓扑和所有链路费用的方法：每个节点向网络中的所有其他路由器广播链路状态分组来完成的。

²  Dijkstra算法：

1)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image117.jpg)定义如下记号：

u  D（v）：随着算法进行本次迭代，从源节点到目的节点v的最低费用路径的费用。

u  p（v）：从源节点到目的节点v沿着当前最低费用路径的前一节点。

u  N’：节点子集；如果从源节点到目的节点v的最低费用路径已确知，v在N’中。

2)         通过为每个目的节点存放从u到它的最低费用路径上的下一跳节点，可以构建一个节点（如节点u）的转发表。

3)         算法复杂性：最坏情况下O（n2）。

4)         算法可能出现的问题：震荡。

5)         震荡的解决方法：

u  强制链路费用不依赖于所承载的流量。（不可接受）

u  确保并非所有的路由器都同时运行LS算法。

**4.5.2****距离向量选路算法**

²  距离向量选路算法：

1)         分布式的：每个节点都要从一个或多个直接相连的邻居接收某些信息，执行计算，然后将计算结果发回给邻居。

2)         迭代的：（1）中的过程持续到邻居之间没有更多的信息要交换为止。

3)         异步的：不要求所有节点相互之间步伐一致地操作。

²  Bellman-Ford方程：

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image119.jpg)

1)         dx（y）：节点x到节点y的最低费用路径的费用；

2)         minv：取遍x所有的邻居。

3)         方程的意义：从x到y的最低费用是对所有邻居v的c（c，v）+dv（y）的最小值。

²  距离向量选路算法基本思想：

1)         每个节点不时向每个邻居发送它的距离向量拷贝；

2)         当某节点收到其任意一个邻居的新距离向量时，使用Bellman-Ford方程更新其距离向量；

3)         所有节点持续以异步方式交换他们的距离向量时，每个费用估计Dx（y）将会收敛到dx（y）——从节点x到节点y的实际最低费用路径的费用。

²  距离向量算法：链路费用变化与链路故障

u  Good news travels fast. Bad news travels slow——选路环路（routing loop）和计数到无穷问题（count-to-infinity）。

²  距离向量算法：增加毒性逆转（poisoned reverse）——解决选路环路及计数到无穷问题。

²  LS与DV选路算法的比较

|                                   | LS                                                           | DV                                                           |
| --------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 报文复杂性                        | 发送O（NE）个报文，且一条链路费用改变时，必须向所有节点发送新的链路费用。 | 在邻居间交换报文，收敛所需时间依赖诸多因素。                 |
| 收敛速度                          | 发送O（NE）个报文的复杂度为O（N2）的算法。                   | 收敛较慢，会遇到选路环路、计数到无穷等问题。                 |
| 健壮性   （一台路由器发生故障时） | 路由计算在某种程度上是分离的，提供了一定的健壮性。           | 一个节点可向任意或所有目的节点通告不正确的最低费用路径，引起大量流量流向故障路由器的现象。 |

**4.5.3****层次选路**

²  LS和DV算法略微理想化：

1)         **规模：**随着路由器数目增多，选路信息的计算、存储及通信的开销将高的惊人。广播LS更新的开销将导致没有剩余的带宽供发送数据分组使用，距离向量算法在大规模的路由器中的迭代将永远不会收敛。

2)         **管理自治：**一个组织应当能够按自己的愿望运行和管理其网络，且还能将其网络与其他外部网络连接。

²  解决办法：自治系统（Autonomous System，AS）

1)         每个AS由一组在相同管理控制下的路由器组成；

2)         相同AS内的路由器执行同样的选路算法——自治系统内部选路协议；

3)         AS彼此互连——AS内一台或多台路由器（称为网关路由器，gateway router）负责向本AS外的目的地转发分组。

²  AS仅有一个网关路由器连接一个其他AS时：网关路由器一旦接收到分组，就将其向通往外部AS的一条链路转发，该链路另一端的AS为该分组向最终目的地选路。

²  AS有两条或更多条链路通往外部AS时：

1)         从相邻AS获取可达性信息；

2)         向本AS中所有路由器传播可达性信息。

²  热土豆选路（hot potato routing）：AS尽可能快（尽可能便宜）的摆脱分组。

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image121.jpg)

 

**4.6****因特网中的选路**

²  选路协议的任务：确定数据报在源与目的地之间采用的路径。

**4.6.1****因特网中自治系统内部选路：****RIP**

²  AS内部选路协议又称为内部网关协议（interior gateway protocol），历史上广泛应用于因特网上的选路协议：

1)         选路信息协议（Routing Information Protocol，RIP）

2)         开放最短路径优先（Open Shortest Path First，OSPF）

²  RIP是一种距离向量协议。

²  跳：沿着从源路由器到目的子网（包括目的子网）的最短路径所经过的子网数量。

²  RIP被限制在网络直径不超过15跳的自制系统内，也即一条路径的最大费用被限制为15。

²  在RIP中，选路更新信息在邻居之间通过使用**RIP****响应报文**（RIP response message）交换，大约30秒交换一次。

²  响应报文又被称作RIP通告（RIP advertisement）。

²  如果一台路由器超过180秒没有监听到其邻居，则该邻居不再被认为是可达的，此时RIP修改本地选路表，然后通过向相邻路由器发送通告来传播该信息。

²  路由器在**UDP**使用端口520发送RIP请求和响应。

²  RIP是一个运行在UDP上的应用层协议。

**4.6.2****因特网中****AS****内部选路：****OSPF**

²  RIP被设置在较低层ISP和企业网中，OSPF与IS-IS被设置在较顶层的ISP中。

²  OSPF中的开放（OPEN）是指选路协议规约是公众可用的。

²  OSPF算法的核心：使用洪泛链路状态信息的链路状态协议和一个Dijkstra最低费用路径算法。

²  OSPF算法中，各条链路的费用是由网络管理员配置的：

1)         设置每条链路费用为1，实现最少跳数选路。

2)         将链路权值与链路容量成反比来设置，从而不鼓励流量使用低带宽链路。

²  OSPF算法中，路由器向自制系统内所有其他路由器广播选路信息：

1)         一条链路的状态发生变化时，路由器广播状态信息；

2)         链路状态未发生变化时，周期性广播链路状态信息。——增强了链路状态算法的健壮性。

²  OSPF通告包含在OSPF报文中，该报文直接承载在IP分组中。——OSPF协议必须自己实现可靠报文传输、链路状态广播等功能。

²  OSPF的优点：

1)         安全：路由器之间的交换都是经过鉴别的，意味着仅有受新任的路由器能参与一个AS内的OSPF协议。两类鉴别方式——简单鉴别与MD5鉴别。

2)         多条相同费用的路径：当存在多条路径具有相同费用时，允许使用多条路径，而不是选择单一的路径来承载所有的流量。

3)         对单播选路与多播选路的综合支持。

4)         支持在单个选路域内的层次结构：OSPF具有按层次结构构造一个自治系统的能力。

²  **层次选路的实现：**一个OSPF自治系统可以配置成多个区域，每个区域内都运行自己的OSPF链路状态选路算法——

1)         一个区域内的每台路由器都向该区域内的所有其他路由器广播器广播其链路状态；

2)         一个区域的内部细节对于该区域外的所有路由器都是不可见的；

3)         在一个区域内，一台或多台区域边界路由器（area border router）负责为发送到该区域外的分组选路；

4)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image123.jpg)主干区域：一个OSPF区域配置成主干区域，为AS内其他区域之间的流量选路，该主干区域包含所有区域边界路由器，还可能包括无边界路由器。

²  OSPF路由器的分类：

1)         内部路由器：位于非主干区域，只执行AS内部选路；

2)         区域边界路由器：同时属于区域与主干两个部分；

3)         主干路由器（非边界路由器）：执行主干中的选路，但自身不是边界路由器；

4)         边界路由器：与属于其他自治系统的路由器交换选路信息。

**4.6.3****自治系统间的选路：****BGP**

²  边界网关协议（Border Gateway Protocol，BGP）：跨越AS的源和目的对之间确定路径。

²  BGP为每个AS提供：

1)         从相邻AS处获得子网可达性信息；

2)         向该AS内部的所有路由器传播这些可达性信息；

3)         基于可达性信息和AS策略，决定到达子网的“好”路由。

4)         允许每个子网向因特网的其余部分通告它的存在，确保AS知道该子网及如何到达——避免每个子网隔离。

²  BGP基础：

1)         路由器对使用179端口的半永久TCP连接来交换选路信息，这样的连接位于：

u  两个不同的AS中的路由器链路——eBGP（external BGP session，外部BGP会话）会话；

u  一个AS中的路由器之间——iBGP会话（internal BGP session，内部BGP会话）。

2)         在BGP中，目的地不是主机而是CDIR化的前缀，每个前缀表示一个子网或一个子网的集合。

3)         任何AS中的网关路由器接收到eBGP学习到的前缀后，该网关路由器使用它的iBGP会话来向该AS中的其他路由器发布这些前缀。

²  路径属性和BGP路由

1)         在BGP中，一个自治系统有其全局唯一的自治系统号（Autonomous System Number，ASN）。

2)         带有属性的前缀被称为一条路由。

3)         BGP对等方彼此通告路由。

4)         两个较为重要的属性：

u  AS-PATH：包含前缀的通告已经通过的AS。当一个前缀传送到一个AS时，该AS将它的ASN增加到AS-PATH属性中。——用于检测和防止循环通告，特别是，如果一台路由器看到它的AS包含在该路径列表中，它将拒绝该通告。

u  NEXT-HOP：开始某AS-PATH的路由器接口。

²  BGP路由选择——顺序调用下列消除规则选择：

1)         路由被指派一个本地偏好值作为其属性之一，具有更高偏好值的路由将被选择；

2)         在余下的路由中，选择具有最短AS-PATH的路由；

3)         在余下的路有种，选择最靠近NEXT-HOP路由器的路由——由AS内部算法决定，通常称为热土豆选路；

4)         仍余下许多路由时，使用BGP标示符来选择路由。

²  选路策略

1)         所有进入桩网络（stub network）的流量必定是以该网络为目的地的，所有离开桩网络的流量必定是源于该网络的。

2)         多宿桩网络：经由两个或两个以上的不同提供商练到其余网络。

​                                                                                                                                                                                                                                                                                   

**4.7****广播和多播选路**

²  广播选路（broadcast routing）：网络层提供从一个源节点到网络中的所有其他节点的交付分组的服务。

²  多播选路（multicast routing）：使单个源节点能够向其他网络节点一个子集发送分组的拷贝。

**4.7.1****广播选路算法**

²  N次单播（N-way-unicast）

1)         源节点产生分组的N次拷贝，对不同目的地的每个拷贝进行编址，并用单播选路向N个目的地传输这N份拷贝。

2)         缺点：

u  低效率；

u  N次单播的隐含假设是广播的接收方及其地址均为发送方所知，这将增加更多的开销；

u  使用单播选路基础设施来实现广播是不明智的。

²  无控制洪泛：

1)         最显而易见的方法。

2)         当某节点接收了一个广播分组时，它复制该分组并向它的所有邻居转发。

3)         致命缺点：

u  若网络节点形成圈，则分组将在期中无休止地循环。

u  广播风暴（broadcast storm）。

²  受控洪泛：

1)         序号控制洪泛（sequence-number-controlled flooding）：

u  源节点将其地址（或其他的唯一标示符）以及广播序号放入广播分组，然后向其所有邻居转发；

u  一个节点接收到一个广播分组时，首先检查该分组是否在其列表中，在则丢弃该分组，不在则复制该分组并向其邻居转发。

2)         反向路径转发（reverse path forwarding，RPF）：当路由器接收到具有给定源地址的广播分组时，仅当该分组到达的链路正好是位于它自己到源的最短单播路径上，它才向所有出链路转发分组。

²  生成树广播：

1)         序号控制洪泛和RPF不能完全避免冗余广播分组的传输。

2)         最小生成树：所有生 成树中费用最小的生成树。

3)         生成树广播的做法：

u  首先对网络节点构造出一棵生成树；

u  源节点发送广播分组时，向生成树的特定链路发送分组；

u  接收广播分组的节点向生成树中的所有邻居转发该分组。

**一个节点不需要知道整棵树，只需知道哪些邻居是生成树邻居。**

 **4.7.2****多播**

²  实现多播选路要面对的问题：

1)         如何标识多播分组的接收方；

2)         如何为发送到接收方的分组编址。

²  多播数据报使用间接地址（address indirection）编址——用一个标识来表示一组接收方（D累多播地址）。

²  与一个D类地址相关联的接收方组称为一个多播组。

²  互联网组管理协议——通知与其相连的路由器在本主机上运行的一个应用程序想一个特定的多播组。

²  多播选路算法：

1)         使用一棵组共享树进行多播选路；

2)         使用一棵基于源的树进行多播选路——为每个源构建一棵多播选路树。

²  距离向量多播选路协议（Distance Vector Multicast Routing Protocol，DVMRP）：实现了具有反向路径转发与剪枝算法的基于源的树。

²  协议无关的多播协议（Protocol-Independent Multicast，PIM）：

1)         稠密模式中，多播组成员的位置分布稠密，即该区域内的许多或大多数路由器都需要参与到多播数据报选路之中。——PIM稠密模式时一种洪泛与剪枝反向路径转发技术。

2)         稀疏模式中，具有相连组成员的路由器数量相对于路由器总数来说很少。——使用汇合点来建立多播分布树。

 

**Chapter 5****：链路层和局域网**

²  链路层信道的两种类型：

1)         广播信道：许多主机被连接到相同的通信信道，需要媒体访问协议来协调传输和避免“碰撞”。

2)         点对点通信链路：如两台路由器之间的通信链路或一台住宅的拨号调制解调器与一台ISP路由器之间的通信链路。

 

 

**5.1****链路层：概述和服务**

²  节点（node）：主机和路由器。

²  链路（link）：沿着通信路径连接相邻节点的通信信道。

**5.1.1****链路层提供的服务**

²  链路层协议定义：

1)         链路两端的节点之间交互的分组格式；

2)         发送和接收分组时节点采取的动作。——差错检测、重传、流量控制和随即接入。

²  链路层协议的任务：将网络层的数据报通过路径中的**单段链路**节点到节点的传送。

²  链路层协议能够提供的服务：

1)         成帧（framing）

2)         链路接入（link access）

3)         可靠交付（reliable delivery）——许多有线的链路层协议不提供可靠交付服务。

4)         流量控制（flow control）：链路每一端的节点都具有有限容量的帧缓存能力。

5)         差错检测（error detection）：十分复杂，且用硬件实现。

6)         差错纠正（error correction）

7)         半双工和全双工（half-duplex and full-duplex）：全双工——链路两端可以同时传输分组；半双工——节点不能同时进行传输和接收。

**5.1.2****链路层在何处实现**

²  链路层的主题部分在网络适配器（network adapter）中实现，网络适配器也称为网络接口卡（network interface card，NIC）。

²  网络适配器的内核是链路层控制器，实现了许多链路层服务的单个特定目的芯片。许多功能是用硬件实现的。

 

**5.2****差错检测和纠错技术**

²  发送方接受的挑战：为避免比特差错，使用差错检测和纠错比特（error-detection and-correction，EDC）来增强数据D。由于传输中比特翻转，到达目的地的EDC’和D’可能不同。

²  接收方接受的挑战：只接收到D’和EDC’判断D’和初始D是否相同，接收方可能无法知道接收的信息中包含比特差错。

**5.2.1****奇偶校验**

²  单个比特校验：不够健壮。

²  二位奇偶校验（two dimensional parity）：包含比特值改变的列和行的校验值都会出现差错。——检测到出错并纠正。

²  前向纠错（Forward Error Correction，FEC）：接收方检测和纠正差错的能力。

**5.2.2****检验和方法**

²  互联网检验和（Internet checksum）：数据的两个字节作为16比特的整数对待并求和，这个和的反码形成了携带在报文首部的互联网检验和。

²  对检验和方法的评价：分组开销小，差错保护相对较弱。

**5.2.3****循环冗余检测**

²  循环冗余检测（Cyclic Redundancy Check，CRC），也称为多项式编码（polynomial code），将发送的比特传看做是系数为0和1的一个多项式。

²  CRC编码操作：发送方和接收方首先协商一个r+1比特模式，称为生成多项式（generator），表示为G。要求G的最高有效位为1。对于一个给定的数据D，发送方选择r个附加比特R，并附加到D上，用模2运算正好能被G整除。

²  CRC差错检测过程：接收方用G除接收到的d+r比特，余数非0则出现差错。

²  所有CRC计算采用模二算术操作，在加法中不进位，减法中不借位。

²  每个CRC标准都可以检测小于r+1比特的突发差错，即所有连续的r比特或者更少的差错都可以被检测到。

²  适当的假设下，长度大于r+1比特的突发差错能以概率1-0.5r被检测到。

²  每个CRC标准可都能检测到任何奇数个比特差错。

 

**5.3****多路访问协议**

²  点对点链路：由链路一端的单个发送方和链路另一端的单个接收方组成。

²  广播链路：能够让多个发送和接收节点连接到相同的、单一的、共享的广播信道。（以太网、无线LAN）

²  多路访问协议（multiple access protocol）：规范节点在共享的广播信道上的传输行为。

1)         信道划分协议（channel partitioning protocol）

2)         随机接入协议（random access protocol）

3)         轮流协议（taking-turns protocol）

²  对于速率为每秒R比特的广播信道，多路访问协议应该有以下所希望的特性：

1)         当只有一个节点有数据发送时，该节点具有Rbps的吞吐量；

2)         当有M个节点要发送数据时，每个节点吞吐量为R/Mbps（平均传输速率）；

3)         协议是分散的，不会因某主节点故障而使整个系统崩溃；

4)         协议是简单的，实现代价不会过高。

**5.3.1****信道划分协议**

²  在共享信道节点之间用于划分广播信道带宽的技术：时分多路复用（TDM）、频分多用复用（FDM）、码分多址（Code Division Multiple Access，CDMA）。

²  TDM：

1)         将时间划分为时间帧（time frame），并进一步划分每个时间帧为N个时隙（slot）；

2)         将每个时隙分配给N个节点中的一个；

3)         某个节点在有分组要发送时，在循环的TDM帧中在指定的时隙中传输其分组比特。

²  对TDM的评价：

1)         优点：

u  消除了碰撞；

u  公平——每个节点在每个帧时间内获得专用传输速率R/Nbps。

2)         缺陷：

u  节点被限制于R/Nbps的平均速率，即使它是唯一有分组要发送的节点；

u  节点必须总是等待在传输序列中的轮次，即使它是唯一有帧要发送的节点。

²  FDM：

1)         将Rbps信道划分为不同频段（每个频段具有R/N带宽），并把每个频率分配给N个节点中的一个。

2)         对其评价与对TDM评价一致。

²  码分多址（Code Division Multiple Access，CDMA）：

1)         为每个节点分配一种不同的编码，每个节点用它唯一的编码来对它发送的数据进行编码。

2)         CDMA的特性——不同节点能够同时传输，且各自相应的接收方仍然能正确接收发送方编码后的数据比特，而不在乎其他节点的干扰传输。

**5.3.2****随机接入协议**

²  随机接入协议中，一个传输节点总是以信道的全部速率（即R bps）进行发送。当有碰撞时，设计碰撞的每个节点反复重发它的帧，直到无碰撞的通过为止。（当经历碰撞时，不立刻重发，而是等待一个随机时延）

²  时隙ALOHA协议：

1)         假设：

 

u  所有帧均为L比特；

u  时间被划分为长度为L/R s的时隙（也即一个时隙等于传输一帧的时间）；

u  节点只在时隙起点传输帧；

u  节点是同步的，每个节点都知道时隙何时开始；

u  如果一个时隙中有碰撞，则所有节点在该时隙结束前得知。

2)         时隙ALOHA协议的操作：

u  节点由新帧发送时，等到下一个时隙开始并在该时隙传输整个帧；

u  没有碰撞，则无需考虑重发；

u  有碰撞，则在时隙结束前检测，然后节点以概率p在后续的每个时隙中重新传输该帧，直至其被无碰撞的传输出去。

3)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image125.jpg)评价：

u  优点：

Ø  当某节点唯一活跃时，可以全速连续传输；

Ø  高度分散：每个节点决定何时重传；

Ø  十分简单。

u  缺点：

Ø  多个活跃节点存在时，一部分时隙将因碰撞而浪费；

Ø  时隙的另一部分将是空闲的：所有活跃节点由于概率传输策略会节制传输。

4)         成功时隙：刚好有一个节点传输的时隙。

5)         时隙多路访问协议的效率：有大量的活跃节点且每个节点总有大量帧要发送时，长期运行中成功时隙的份额。

6)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image127.jpg)对时隙ALOHA最大效率的推导可得知：37%为协议最大效率，也即最大传输速率仅为0.37R bps；此外，37%的时隙将是空闲的，36%的时隙将有碰撞产生。

²  ALOHA：

1)         纯ALOHA中，第一帧首次到达，节点立刻将该帧完整的传播进广播信道。若有碰撞产生，则立即（传输完当前碰撞帧后）以概率p重传该帧，否则该节点等待一个帧的传输时间后以概率p重传。

2)         ALOHA的最大效率：2e/1。

²  载波侦听多路访问（CSMA）：

1)         载波侦听（carrier sensing）：即一个节点在传输前先听信道。

2)         碰撞检测（collision detection）：即一个传输节点在传输时一直在侦听信道。

3)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image129.jpg)碰撞还是会存在：信道传播时延。

**4)**         节点执行碰撞检测时，一旦检测到碰撞立即停止传输。

**5.3.3****轮流协议**

²  轮询协议（polling protocol）：节点之一被指定为主节点，主节点以循环的方式轮询每个节点。

²  轮询协议消除了碰撞和空时隙，使得效率更高。

²  轮询的缺点：

1)         引入了轮询时延，即通知一个节点它可以传输所需的时间；

2)         主节点有故障时，整个信道都将变得不可操作。

²  令牌传递协议（token-passing protocol）：一个称为令牌（token）的特殊目的帧在节点之间以某种固定的次序进行交换。当一个节点接到令牌时，仅当它有一些帧要发送时，它才持有这个令牌。若一个节点接收到令牌且需要发送帧，则发送最大数目的帧，然后转交令牌给下一节点。

²  对令牌传递协议的评价：

1)         分散，且效率十分高；

2)         若节点忘记了释放令牌，必须使用某些恢复步骤使令牌返回到循环中来。

**5.3.4****局域网**

²  流行的两类LAN技术：

1)         以太网LAN，基于随机接入；

2)         由令牌传递技术组成的LAN技术，包括令牌环、光纤式分布数据接口（Fiber Distributed Data Interface，FDDI）。

²  令牌环LAN：LAN的N个节点（主机和路由器）通过直接链路连接成一个环。令牌环的拓扑定义了令牌传递的次序。当某节点获得了令牌并发送一个帧时，该帧绕着整个换传播，从而创建一个虚拟广播信道。

 

**5.4****链路层编址**

**5.4.1 MAC****地址**

²  LAN地址的不同称呼：LAN地址、物理地址、MAC地址。

²  链路层地址也称为MAC地址（因其流行）。

²  MAC地址被设计为永久的，但用软件改变一块适配器的MAC地址是可能的。

²  没有两台适配器具有相同的地址。

²  适配器的MAC地址具有扁平结构（与层次结构相反），无论适配器到哪里都不会发生变化。

²  当某适配器要向某些适配器发送一个帧时，发送适配器将目的适配器的MAC地址插入到该帧中，并将该帧发送到LAN上。

1)         若该LAN是广播LAN，这个帧会被该LAN上的所有其他适配器接收和处理；

2)         接收到该帧的每个适配器将检查该帧的目的地址与自己的MAC地址是否匹配：

u  匹配：取出封装的数据包，并沿协议栈向上传递给它的父节点。

u  不匹配：该适配器丢弃该帧，不向上传递。

u  当目的节点收到该帧时，仅有它将会中断父节点。

²  MAC广播地址——让LAN上所有的其他适配器来接收并处理打算发送的帧：48个连续的1。

**5.4.2****地址解析协议**

²  地址解析协议（Address Resolution Protocol，ARP）：网络层地址和链路层地址之间的转换。

²  ARP只为在同一个子网上的节点解析IP地址。

²  ARP的工作流程：

1)         每个节点的ARP模块都在它的RAM中有一个ARP表，包含IP地址到MAC地址的映射和生存周期。

2)         当所查询的节点在发送方的ARP表中有相应表项时，直接查询即可。

3)         没有相应表项时，广播ARP查询分组，匹配节点给查询节点发送回一个带有所希望映射的响应ARP分组。

²  关于ARP协议需要注意：

1)         查询ARP报文是在广播帧中发送的，而响应ARP报文在一个标准帧中发送；

2)         ARP是即插即用的，无需配置，节点断开连接时，表项最终会被删掉。

²  发送数据包到子往外的节点：P302-303

 

**5.5****以太网**

²  集线器（hub）：物理层设备，作用于比特。当一个比特到达一个接口时，集线器重新生成这个比特，将其能量强度放大，并向其他所有接口传输出去。

²  基于集线器星型拓扑的以太网是一个广播LAN。

²  若某集线器同时从两个不同的接口接收到帧，出现碰撞，则生成该帧的节点必须重新传输该帧。

**5.5.1****以太网帧结构**

²  以太网帧的字段：

1)         数据字段（data field）：承载IP数据报（也能承载其他网络层分组，此处以IP数据报为例）。以太网最大传输单元（MTU）是1500字节，大于则需给数据报分段；最小长度为46字节，小于则需填充数据报字段。

2)         目的地址（destination address）：包含目的适配器的MAC地址。

3)         源地址（source address）：包含传输该帧到LAN上的适配器的MAC地址。

4)         类型字段（type field）：允许以太网复用多种网络层协议。

5)         循环冗余检测（Cyclic Redundancy Check，CRC）：接收适配器检测帧中是否引入了差错。

6)         前同步码（preamble）：以太网帧以一个8字节的前同步码开始。前同步码的前七个字节都是10101010，最后一个字节是10101011。前七个字节用于“唤醒”接收适配器，并且将它们的时钟与发送方同步。第八个字节的最后两个比特“11”警告接收适配器：“重要的内容”即将到来。

²  曼彻斯特编码：每个比特包含一次跳变——1从高电平跳变为低电平，0从低电平跳变为高电平。

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image131.jpg)使用曼彻斯特编码的原因：发送适配器和接收适配器没有精确同步，通过每一次跳变，接受主机能够将时钟同步，时钟同步后，接收方就能对每个比特定界，确定它是1还是0。

²  曼彻斯特编码是一种物理层操作。

²  以太网技术向网络层提供无连接服务。

²  以太网技术向网络层提供不可靠服务。例如，适配器接收到帧后，对该帧执行CRC校验，但无论通过校验与否，此适配器都不会发送确认帧或否定帧。

**5.5.2 CSMA/CD****：以太网的多路访问协议**

²  CSMA/CD使用的机制：

1)         适配器可以在任何时刻开始传输，没有时隙的概念；

2)         使用载波侦听；

3)         使用碰撞检测；

4)         尝试重传之前，适配器等待一个随机时间（通常小于传输一帧的时间）。

²  CSMA/CD的工作方式：

1)         适配器从网络层得到一个数据报，准备一个以太网帧，并将该帧放到适配器缓存区；

2)         若适配器侦听到信道空闲，则传输该帧；若侦听到信道忙，则等待到不再听到信号能量后传输；

3)         传输过程中，若未侦听到其他信号能量，则持续传输直至结束；

4)         传输过程中，若侦听到其他信号能量，则停止传输，代之以传输48比特的阻塞信号；

5)         在中止传输后，适配器进入一个指数后退（exponential backoff）阶段。

注：

1)         阻塞信号的目的：确保所有其他的传输适配器都意识到此次碰撞。

2)         指数后退算法：在帧经受了一连串的n此碰撞后，适配器随机的从{0,1,2,…2m-1}等概率的为K选择一个值，其中m=min（0,10），然后适配器等待K*512比特时间后重新开始传输该帧。由于选择K的集合长度随着碰撞次数的增加呈指数增长（直到n=10），该算法称为指数后退。

²  以太网效率：当有大量的活跃节点，并且每个节点由大量的帧要发送时，帧在信道中午碰撞地传输的那部分时间占长期运行时的份额。

**5.5.3****以太网技术**

²  吉比特以太网标准：IEEE802.3z

1)         使用标准以太网帧格式，后向兼容10BASE-T与100BASE-T技术，很容易在已有以太网设备基础上集成；

2)         允许点对点链路及共享广播信道；

3)         使用CSMA/CD来共享广播信道；

4)         对于点对点信道，允许在两个方向上以1000Mbps全双工操作。

 

**5.6****链路层交换机**

²  现代以太网LAN使用星型拓扑——每个节点与中心交换机互连。

²  交换机的任务：接收入链路层帧并转发到出链路。

²  交换机自身对于节点来讲是**透明的**——某节点向另一个节点寻址一个帧（而不是通过交换机），顺利将其发送进LAN，而不知道交换机将会接收该帧并将其转发至另一节点。

**5.6.1****交换机转发和过滤**

²  过滤（filtering）：交换机决定一个帧是应该转发到某个接口还是应当将其丢弃的功能。

²  转发（forwarding）：决定一个帧应该被导向哪个接口，并把该帧接口移动到这些接口的交换机功能。

²  过滤与转发都借助交换机表完成：

1)         包含其LAN上的某些节点但不是全部节点；

2)         交换机表中的一个表项包含：

u  节点的MAC地址；

u  到达该节点的交换机接口；

u  用于节点的表项放置的表中的时间。

²  交换机转发分组基于MAC地址而非IP地址。

²  交换机的工作过程：

**假设具有目的地址****DD-DD-DD-DD-DD-DD****的帧从交换机接口****x****到达，交换机用****MAC****地址****DD-DD-DD-DD-DD-DD****索引它的表：**

1)         表中没有针对该MAC地址的表项：向除了接口x外的所有接口前面的缓存转发该帧的拷贝（也即广播该帧）。

2)         表中有表项将该MAC地址与接口x联系起来：说明该帧从包括适配器DD-DD-DD-DD-DD-DD的LAN网段来，此时只需丢弃该帧，执行过滤功能。

3)         表中有表项将该MAC地址与接口y联系起来，且y≠x：转发该帧到与接口y相连的网段。

**5.6.2****自学习**

²  交换机的自学习（self-learning）：交换机表示自动的、动态的、自治的建立起来的。

²  自学习的实现方式：

1)         交换机表初始为空；

2)         对于某接口接收到的每个入帧，交换机在其表中存储：

u  该帧源地址地段中的MAC地址；

u  该帧到达的接口；

u  当前时间。

**注：这样如果在****LAN****节点上每个节点最终都发送了一个帧，则每个节点将在这张表中记录下来。**

3)         在一段时间（老化期）后，若交换机没有接受到以改地址作为源地址的帧，就在表中删除这个地址。

**注：以这种方式，若一台****PC****被另一台****PC****替换，则原****PC****的****MAC****地址最终将被交换机清除。**

²  交换机是即插即用设备（plug-and-play device）：无需网络管理员或用户的干预。

²  交换机是双工的：任何节点与交换机连接的链路，节点好交换机能够同时传输而无碰撞。

**5.6.3****链路层交换机的性质**

²  交换机的优点：

1)         消除碰撞：交换机缓存帧，且决不会在网段上同时传输多余一个帧，最大聚合带宽是该交换机所有接口速率之和，比广播链路的LAN具有更高的性能；

2)         异质的链路：交换机将链路彼此隔离，LAN中的不同链路能够以不同速率运行，并且能够在不同媒体上运行；

3)         管理：

u  若适配器工作异常并持续发送以太帧（快而含糊的，jabbering），交换机可检测到该问题并在内部断开异常适配器；

u  交换机可手收集带宽使用的统计数据、碰撞率和流量类型，并把这些信息提供给网络管理者使用。

**5.6.4**交换机和路由器的比较

²  交换机是第二层的分组交换机，路由器是第三层的分组交换机。

²  交换机：

1)         优点：

u  即插即用；

u  具有相对高的分组过滤和转发速率。

2)         缺点：

u  为防止广播帧的循环，交换网络的活跃拓扑限制为一棵生成树；

u  交换网络要求在该节点有大的ARP表，将生成可观的ARP流量和处理量；

u  交换机对于广播风暴不提供任何保护措施，若某主机出现故障并传输大量以太网广播帧流，交换机将转发所有帧，致使以太网崩溃。

²  路由器：

1)         优点：

u  网络寻址是分层次的，即使网络中存在冗余路径，分组通常也不会通过路由器循环；且分组不会限制在一棵生成树上，可以使用源到目的地的最佳路径，可以用各种拓扑结构来构建因特网；

u  对第二层的广播风暴提供防火墙保护。

2)         缺点：

u  不是即插即用；

u  对每个分组的处理时间相较于交换机更长；

u  浪费了许多时间争论路由器的正确发音。

²  怎样选择是使用路由器还是交换机？

1)         几百台主机组成的小网络——交换机：不要求IP地址的任何配置就能使流量局部化并增加总计吞吐量；

2)         几千台主机组成的大网络——路由器：提供更健壮的流量隔离方式和广播风暴控制。

²  流行的互联网设备的典型特色比较：

|          | 集线器 | 路由器 | 交换机 |
| -------- | ------ | ------ | ------ |
| 流量隔离 | 无     | 有     | 有     |
| 即插即用 | 有     | 无     | 有     |
| 优化选路 | 无     | 有     | 无     |
| 直通交换 | 有     | 无     | 有     |

 

**5.7 PPP****：点对点协议**

²  点对点协议：运行于点对点链路之上的链路层协议，也即一条直线连接两个节点的链路，链路的每一端有一个节点。

²  对PPP的初始设计要求：

1)         分组成帧：PPP协议链路层的发送方必须能封装网络层分组在其链路层帧中；

2)         透明性：不能对网络层分组中的数据做任何限制；

3)         多种网络层协议：必须能够支持同时运行在物理链路上的多种网络层协议，要求PPP至少需要一个协议类型字段或其他相似的机制；

4)         多种类型链路：必须能运行在不同类型的链路上，如串行的、并行的等；

5)         差错检测：必须能够检测到接收帧中的比特差错；

6)         连接的活性：必须能够检测到链路层次的故障，并且通知网络层；

7)         网络层地址协商：必须向网络层提供机制，获知或者配置相互的网络层地址；

8)         简单性。

²  不要求PPP实现的功能：差错纠正、流量控制、有序、多点链路。

²  PPP帧包含的字段：

1)         标识字段：每个PPP帧都是用值01111110的1字节标识字段作为开始和结束。

2)         地址字段：唯一可能值为11111111。

3)         控制字段：唯一可能值为00000011.

**PPP****规范指出地址字段和控制字段“可能在以后定义”，协议允许发送方不发送这两个字段的值，为帧省下了两个字节的开销。**

4)         协议：该字段指明所接收的封装数据所属的上层协议。

5)         信息：包含上层协议在PPP链路上发送的被封装分组（数据），最大的默认长度是1500字节（首次配置时能改变这个值）。

6)         检验和：检测已传输帧中的比特差错。

²  字节填充：解决标识字段（01111110）的值出现在信息字段中，导致接收方错误检测为帧结束的问题。

²  字节填充的实现：在非标识字段的01111110前加入控制转义字节，指示随后的01111110不是标识字段。类似的，如果控制转义字节的比特模式自身作为实际数据出现，它前面也必须填充一个控制转义字节。——接收方在数据流中看到单个控制转义字节时，知道该字节是被填充到数据流中的。相继出现的一堆控制转义字节意味着要在发送的初始数据中出现了一个控制转义字节的实例。

 

**5.8****链路虚拟化：网络作为链路层**

²  互联网媒体是一种复杂的交换基础设施。

²  主机维持的观点：互联媒体是连接两台或多台主机的链路层信道。——主机可以不知道它是通过一个单一短LAN网段还是一个地理上分布的交换LAN与其他LAN主机进行连接。

**5.8.1****异步传输方式**

²  异步传输方式（Asynchronous Transfer Mode，ATM）的目标：设计一种单一的网络技术，传输实时音频、视频以及文本、电子邮件和图像文件。

²  ATM支持的服务模式：恒定比特率服务、可变比特率服务、可用比特率服务和不指明比特率服务。

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image133.jpg)ATM适配层（ATM Adaption Layer，AAL），类比于因特网的运输层，仅出现在位于因特网边缘的ATM设备上。

²  AAL被定义用于以下服务：

1)         恒定比特率服务和电路仿真；

2)         可变比特率服务（可变比特率视频）；

3)         数据服务（如IP数据报传输）。

**注：****AAL****执行的服务中有差错检测和分段****/****重装。**

²  AAL处理的数据单元称为AAL协议数据单元（Protocol Data Unit，PDU）。

²  ATM层：定义了ATM信元的结构和该信元中各个字段的含义。

²  ATM信元中各字段：

1)         虚通道表示（VCI）：指示信元属于哪个虚通道。

2)         负载类型（PT）：指示包含在信元中的有效载荷的类型。包含一个比特用于指示在一个AAL PDU中的最后一个信元。

3)         信元丢失优先级（CLP）比特：发生拥塞并且ATM交换机必须丢弃信元时，交换机使用该比特丢弃优先级低的信元。

4)         首部差错控制（HEC）字节：保护信元首部差错检测比特。

²  源能够向目的地开始发送信元之前，ATM网络首先创建一条从源到目的地的虚通道，虚通道标识与每条链路相联系。无论何时创建或拆除一个VC必须更新VC转换表（使用永久VC的情况除外）。

²  ATM物理层：处理物理媒体上的电压、比特定时和帧。

²  在ATM上传输IP

1)         每个入口/出口点是一台路由器，当数量相对少时，可在入口/出口点采用永久的VC，避免动态的建立和拆除VC。

2)         连接到ATM的路由器需要两个地址：IP地址、MAC地址。

3)         入口路由器的任务：

u  检查数据报的目的地址；

u  索引路由器的选路标，决定出口路由器IP地址；

u  在ARP表中，使用出口路由器的IP地址，索引其物理地址；

u  将该数据报连同其出口路由器的ATM地址，向下传递到链路层。

4)         数据报被入口路由器向下传递到链路层后：

u  ATM确定通向ATM目的地址的虚通道的VCI；

u  在虚通道的接收端，ATM将数据报分段为信元，在该虚通道的接收端，将这些信元重装为初始数据报。

Ø  IP分段：将初始数据报分成不超过48字节的报文段——存在问题，IP报文段首部为20字节，因此ATM信元携带的报文段仅有28字节有效信息。

Ø  AAL5分段/重装。

5)         在ATM源和ATM目的地之间的每台交换机，ATM信元由ATM物理层和ATM层处理，而不涉及AAL。当到达ATM目的地址后，信元被分配给特殊虚通道的AAL缓存，然后重新构造AAL5 PDU，提取出数据报，并向上传递给IP层协议栈。

**5.8.2****多协议标签交换**

²  多协议标签交换（Multiprotocol Label Switching，MPLS）：对于基于固定长度标签和虚电路的技术，通过选择性的标识数据报并允许路由器基于固定长度的标签转发数据报（而不是目的地址）。

²  MPLS首部：

1)         标签：虚电路标示符；

2)         3比特保留用于实验；

3)         单个S比特用于指示一系列的“成栈”的MPLS首部的结束（不讨论）；

4)         寿命字段。

²  MLPS加强的帧仅能在两个均为MLPS使能的路由器之间发送，这样的路由器被称为标签交换路由器。

²  标签交换路由器不需要提取目的IP地址和在转发表中执行最长前缀匹配的查找。

 

**Chapter 6****：无线网络和移动网络**

**6.1****概述**

²  无线网络中的元素：

1)         无线主机：主机本身可能移动，也可能不移动。

2)         无线链路：主机通过无线链路连接到一个基站或者另一个主机。

3)         基站（base station）：向与之关联的无线主机发送数据和从主机那里接收数据（例如分组），例如蜂窝塔（cell tower）和802.11无线LAN中的接入点。——起链路层中继的作用

**注：一台无线主机与基站“相关联”是指**

u  **主机位于该无基站的无线通信覆盖范围内；**

u  **主机使用该基站中继它和更大网络之间的数据。**

4)         网络基础设施：无线主机希望与之进行通信的更大网络。

²  自组织网络（ad hoc network）：

1)         没有基站；

2)         节点只能与在自身连接范围内的节点联系；

3)         节点之间搭建局域网（不能连接互联网）。

²  切换（handoff）：当一台移动主机移动范围超出一个基站的覆盖范围而到达另一个基站的覆盖范围后，它将改变其接入更大网络的连接点。

²  对无线网络的分类：

|      | 基于基础设施                                                 | 无基础设施                                                   |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 单跳 | 具有与较大的有线网络连接的基站，该基站与无线主机之间的所有通信都经过一个无线跳。 | 存在与无线网络相连的基站，例如蓝牙网络、自组织模式的802.11网络。 |
| 多跳 | 一个表现为以有线网络与较大网络相连，节点与该基站通信，可能通过其他无线节点中继通信。 | 没有基站，且节点为到达目的地可能在其他几个无线节点之间中计报文。节点可能是移动的，可在多个节点中改变连接关系。 |

 

**6.2****无线链路和网络特征**

²  无线链路的特征：

1)         递减的信号强度（路径损耗，Pass loss）：电磁波在穿过物体时强度会减弱，在自由空间中，信号会扩散；

2)         来自其他源的干扰：在同一个频段发送信号的电波源将相互干扰（波峰加波峰信号增强，波谷加波谷信号减弱）；

3)         多路径传播：电磁波的一部分受物体和地面反射，在发送方和接收方之间通过长度不同的路径，称为多径传播（multiple propagation），这使得接收方收到的信号变得模糊。

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image135.jpg)信噪比（Signal-to-Noise Ratio，SNR）：所收到的信号与噪声强度的相对测量。

²  较大的SNR使得接收方更容易从背景噪声中提取传输的信号。

²  比特率差错（Bit Error Rate）：接收方收到的有错的传输比特的概率。

²  为在理想信道上传输信息，需要使用调制技术对信息进行编码：

1)         对于给定的调制方案，SNR越高，BER越低。

2)         对于给定的SNR，具有较高传输率的调制技术（无论差错与否）将具有较高的BER。

3)         物理层调制技术的动态选择能用于适配对信道条件的调制技术。

²  隐藏终端问题（hidden terminal problem）

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image137.jpg)

1)         环境的物理阻挡，例如一座大山或者一座建筑；

2)         无线媒体传输时信号强度的衰减。

²  CSMA（码分多址）

1)         要发送的每一比特都乘以一个信号（编码）的比特来进行编码，这个信号的变化速率（通常称为码片速率）比初始比特序列的速率快得多。

2)         ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image139.jpg)

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image141.jpg)

**6.3 WiFi****：****802.11****无线****LAN**

**6.3.1 820.11****体系结构**

²  基本结构：

1)         基本服务集（Base Service Set，BSS）：包含一个或多个无线站点和中央基站（接入点）；

2)         BSS连接到一个互联设备上，可能为交换机或路由器；

3)         互联设备连接到因特网中。

²  配置AP的无线LAN被称作基础设施无线LAN，其中基础设施是指AP以及互联AP和路由器的有限以太网。

²  802.11定义了11个部分重叠的信道。

²  被动扫描：扫描信道和监听信标帧的过程。

²  主动扫描：向位于无线主机范围内的所有AP广播探测帧。

**6.3.2 802.11 MAC****协议**

²  一个站点有一个帧要发送时：

1)         若站点初始时监听到信道空闲，则在分布式帧间间隔（Distributed Inter-Frame Space，DIFS）后发送该帧；

2)         否则，选取一个随机回退值并且在侦听到信道空闲时递减该值，侦听到信道忙时，保持该值不变；

3)         计数值减为0时，站点发送整个数据帧并等待确认；

4)         若收到确认，则说明该帧被正确接收。

²  ![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image143.jpg)预约机制（在隐藏终端的情况下避免碰撞）：

1)         发送方要发送DATA帧之前，首先向AP发送一个短请求发送帧（Request to Send，RTS），指出传输DATA帧和确认帧需要的总时间；

2)         AP接到RTS帧后，广播一个CTS（Clear To Send）帧作为响应：

u  给发送方明确的发送允许；

u  指示其他站点在预约期内发送。

²  使用RTS和CTS的评价：

1)         缓解隐藏终端问题，长DATA帧只有在信道预约后才能传输；

2)         RTS和CTS帧本身很短，就算碰撞，也仅持续很短时间，一旦它们被正确传输，后续的DATA帧和ACK帧将被无碰撞的发送；

3)         引入了时延，且消耗了信道资源。

**6.3.3 IEEE 802.11****帧**

![img](file:///C:/Users/INPLUS~1/AppData/Local/Temp/msohtmlclip1/01/clip_image145.jpg)

²  有效载荷与CRC字段。

²  地址字段：

1)         地址1：接收帧的无线站点的MAC地址；

2)         地址2：传输帧的站点的MAC地址；

3)         地址3：BSS是一个无线子网的一部分，经一些路由器接口与其他子网相连，地址3包括这个路由器接口的MAC地址；

4)         地址4：AP在自组织模式中互相转发时使用。

²  序号、持续期和帧控制字段：

1)         序号：使接收方重新区分新传输的帧和以前帧的重传；

2)         持续期：传输数据帧的时间和传输确认的时间。

 

 